# ğŸ”¬ PQ-Torè®ºæ–‡è¡¥å……å®éªŒæ–¹æ¡ˆ

**åˆ›å»ºæ—¶é—´**: 2025-11-06
**ç›®æ ‡**: ä¸ºå­¦æœ¯è®ºæ–‡è¡¥å……å®Œæ•´çš„å®éªŒæ•°æ®

---

## ğŸ“‹ å®éªŒæ¦‚è§ˆ

### å½“å‰å·²æœ‰æ•°æ® âœ…
- [x] PQ-Ntoræ¡æ‰‹æ€§èƒ½ï¼ˆ1000æ¬¡è¿­ä»£ï¼‰
- [x] ç«¯åˆ°ç«¯HTTPè¯·æ±‚éªŒè¯
- [x] 3è·³ç”µè·¯å»ºç«‹æˆåŠŸç‡

### éœ€è¦è¡¥å……çš„å®éªŒ ğŸ“Š

| å®éªŒ | ä¼˜å…ˆçº§ | é¢„è®¡æ—¶é—´ | ç›®çš„ |
|------|--------|---------|------|
| 1. å¤§è§„æ¨¡ç»Ÿè®¡æµ‹è¯• | â­â­â­â­â­ | 2å°æ—¶ | å¢å¼ºç»Ÿè®¡å¯ä¿¡åº¦ |
| 2. ä¼ ç»ŸTorå¯¹æ¯”å®ç° | â­â­â­â­â­ | 1å‘¨ | ç›´æ¥æ€§èƒ½å¯¹æ¯” |
| 3. å¹¶å‘æ€§èƒ½æµ‹è¯• | â­â­â­â­ | 1å¤© | è¯„ä¼°æ‰©å±•æ€§ |
| 4. ç½‘ç»œå»¶è¿Ÿå½±å“ | â­â­â­â­ | 1å¤© | çœŸå®ç½‘ç»œæ¨¡æ‹Ÿ |
| 5. èµ„æºä½¿ç”¨åˆ†æ | â­â­â­ | 0.5å¤© | CPU/å†…å­˜åˆ†æ |
| 6. ä¸åŒPQç®—æ³•å¯¹æ¯” | â­â­â­ | 1å‘¨ | ç®—æ³•é€‰æ‹©éªŒè¯ |
| 7. ç«¯åˆ°ç«¯ååé‡ | â­â­ | 0.5å¤© | æ•°æ®ä¼ è¾“æ€§èƒ½ |

---

## å®éªŒ1: å¤§è§„æ¨¡ç»Ÿè®¡æµ‹è¯•

### ç›®æ ‡
- æ”¶é›†10æ¬¡è¿è¡Œï¼Œæ¯æ¬¡10,000æ¬¡æ¡æ‰‹
- è®¡ç®—ç½®ä¿¡åŒºé—´å’Œç»Ÿè®¡æ˜¾è‘—æ€§
- æä¾›æ›´å¯é çš„æ€§èƒ½æ•°æ®

### å®éªŒè„šæœ¬

```bash
#!/bin/bash
# experiments/run_large_scale_benchmark.sh

RESULTS_DIR="results/large_scale"
mkdir -p $RESULTS_DIR

echo "==================================="
echo "å¤§è§„æ¨¡PQ-Ntoræ€§èƒ½åŸºå‡†æµ‹è¯•"
echo "==================================="

# 10æ¬¡ç‹¬ç«‹è¿è¡Œ
for run in {1..10}; do
    echo "Run $run/10..."
    ./benchmark_pq_ntor 10000 > $RESULTS_DIR/run_${run}.csv
    sleep 5  # å†·å´CPU
done

echo "æ‰€æœ‰è¿è¡Œå®Œæˆï¼"
echo "æ•°æ®ä¿å­˜åœ¨: $RESULTS_DIR/"

# ç»Ÿè®¡åˆ†æ
python3 << 'EOF'
import pandas as pd
import numpy as np
import glob

# è¯»å–æ‰€æœ‰è¿è¡Œæ•°æ®
files = sorted(glob.glob('results/large_scale/run_*.csv'))
data = []

for f in files:
    df = pd.read_csv(f)
    data.append(df)

# åˆå¹¶æ•°æ®
all_data = pd.concat(data, ignore_index=True)

# è®¡ç®—ç»Ÿè®¡é‡
operations = ['Client Create Onionskin', 'Server Create Reply',
              'Client Finish Handshake', 'Full Handshake']

print("\n" + "="*70)
print("å¤§è§„æ¨¡æµ‹è¯•ç»Ÿè®¡ç»“æœ (10 runs Ã— 10000 iterations = 100,000 samples)")
print("="*70)

for op in operations:
    op_data = all_data[all_data['Operation'] == op]
    avg = op_data['Avg(Î¼s)'].mean()
    std = op_data['Avg(Î¼s)'].std()
    ci_95 = 1.96 * std / np.sqrt(len(op_data))

    print(f"\n{op}:")
    print(f"  Average: {avg:.2f} Î¼s")
    print(f"  Std Dev: {std:.2f} Î¼s")
    print(f"  95% CI:  [{avg-ci_95:.2f}, {avg+ci_95:.2f}] Î¼s")

print("="*70)
EOF
```

### é¢„æœŸè¾“å‡º

```
å¤§è§„æ¨¡æµ‹è¯•ç»Ÿè®¡ç»“æœ (10 runs Ã— 10000 iterations = 100,000 samples)
======================================================================

Client Create Onionskin:
  Average: 7.90 Î¼s
  Std Dev: 0.15 Î¼s
  95% CI:  [7.75, 8.05] Î¼s

Server Create Reply:
  Average: 23.64 Î¼s
  Std Dev: 0.42 Î¼s
  95% CI:  [23.22, 24.06] Î¼s

Client Finish Handshake:
  Average: 17.05 Î¼s
  Std Dev: 0.31 Î¼s
  95% CI:  [16.74, 17.36] Î¼s

Full Handshake:
  Average: 48.86 Î¼s
  Std Dev: 0.73 Î¼s
  95% CI:  [48.13, 49.59] Î¼s
======================================================================
```

---

## å®éªŒ2: ä¼ ç»ŸTorå¯¹æ¯”å®ç° â­ æœ€é‡è¦

### ç›®æ ‡
- å®ç°ä¼ ç»ŸNtorï¼ˆX25519ï¼‰ç‰ˆæœ¬
- åœ¨ç›¸åŒç¡¬ä»¶ä¸Šè¿›è¡ŒA/Bæµ‹è¯•
- æä¾›ç›´æ¥çš„æ€§èƒ½å¯¹æ¯”æ•°æ®

### å®ç°æ­¥éª¤

#### Step 1: æ·»åŠ X25519 Ntorå®ç°

```bash
# src/ntor_traditional.h
#ifndef NTOR_TRADITIONAL_H
#define NTOR_TRADITIONAL_H

#include <stdint.h>
#include <openssl/evp.h>

// Traditional Ntor with X25519
typedef struct {
    EVP_PKEY *keypair;
    uint8_t public_key[32];
    uint8_t private_key[32];
} ntor_client_state_t;

typedef struct {
    uint8_t public_key[32];
    uint8_t auth[32];
} ntor_onionskin_t;  // 64 bytes (vs PQ: 820 bytes)

typedef struct {
    uint8_t public_key[32];
    uint8_t auth[32];
} ntor_reply_t;  // 64 bytes (vs PQ: 800 bytes)

// API (ä¿æŒä¸PQ-Ntorä¸€è‡´)
int ntor_client_create_onionskin(
    ntor_client_state_t *state,
    const uint8_t *server_id,
    const uint8_t *server_pk,
    ntor_onionskin_t *onionskin_out
);

int ntor_server_create_reply(
    const uint8_t *server_id,
    const uint8_t *server_sk,
    const ntor_onionskin_t *onionskin,
    ntor_reply_t *reply_out,
    uint8_t *key_material_out
);

int ntor_client_finish(
    ntor_client_state_t *state,
    const ntor_reply_t *reply,
    const uint8_t *server_id,
    uint8_t *key_material_out
);

#endif
```

#### Step 2: å®ç°åŸºå‡†æµ‹è¯•

```c
// benchmark/benchmark_ntor_comparison.c
#include <stdio.h>
#include <time.h>
#include "ntor_traditional.h"
#include "pq_ntor.h"

#define NUM_ITERATIONS 10000

typedef struct {
    double min, max, avg, median;
    double samples[NUM_ITERATIONS];
} perf_stats_t;

void run_traditional_ntor_benchmark(perf_stats_t *stats) {
    // ... å®ç°ä¼ ç»ŸNtoræµ‹è¯•
}

void run_pq_ntor_benchmark(perf_stats_t *stats) {
    // ... å®ç°PQ-Ntoræµ‹è¯•
}

int main() {
    perf_stats_t trad_stats, pq_stats;

    printf("Running Traditional Ntor benchmark...\n");
    run_traditional_ntor_benchmark(&trad_stats);

    printf("Running PQ-Ntor benchmark...\n");
    run_pq_ntor_benchmark(&pq_stats);

    // å¯¹æ¯”è¾“å‡º
    printf("\n=== Performance Comparison ===\n");
    printf("Traditional Ntor: %.2f Î¼s\n", trad_stats.avg);
    printf("PQ-Ntor:          %.2f Î¼s\n", pq_stats.avg);
    printf("Overhead:         %.2fx\n", pq_stats.avg / trad_stats.avg);

    return 0;
}
```

#### Step 3: å¯¹æ¯”æµ‹è¯•è„šæœ¬

```bash
#!/bin/bash
# experiments/compare_traditional_vs_pq.sh

echo "==================================="
echo "Traditional Ntor vs PQ-Ntor å¯¹æ¯”æµ‹è¯•"
echo "==================================="

# ç¼–è¯‘å¯¹æ¯”ç¨‹åº
make benchmark_ntor_comparison

# è¿è¡Œå¯¹æ¯”æµ‹è¯•
./benchmark_ntor_comparison > results/ntor_comparison.txt

# å¯è§†åŒ–å¯¹æ¯”
python3 << 'EOF'
import matplotlib.pyplot as plt
import numpy as np

# æ•°æ®ï¼ˆä»æµ‹è¯•ç»“æœä¸­æå–ï¼‰
categories = ['Client\nCreate', 'Server\nReply', 'Client\nFinish', 'Full\nHandshake']
traditional = [3.5, 12.8, 8.2, 24.5]  # Î¼s (ç¤ºä¾‹æ•°æ®)
pq = [7.9, 23.6, 17.1, 48.9]  # Î¼s (å®é™…æ•°æ®)

x = np.arange(len(categories))
width = 0.35

fig, ax = plt.subplots(figsize=(10, 6))
bars1 = ax.bar(x - width/2, traditional, width, label='Traditional Ntor', color='skyblue')
bars2 = ax.bar(x + width/2, pq, width, label='PQ-Ntor (Kyber-512)', color='salmon')

ax.set_ylabel('Latency (Î¼s)', fontsize=12)
ax.set_title('Traditional Ntor vs PQ-Ntor Performance Comparison', fontsize=14)
ax.set_xticks(x)
ax.set_xticklabels(categories)
ax.legend()
ax.grid(axis='y', alpha=0.3)

# æ·»åŠ æ•°å€¼æ ‡ç­¾
for bars in [bars1, bars2]:
    for bar in bars:
        height = bar.get_height()
        ax.text(bar.get_x() + bar.get_width()/2., height,
                f'{height:.1f}',
                ha='center', va='bottom', fontsize=10)

plt.tight_layout()
plt.savefig('results/figures/ntor_comparison.pdf', dpi=300)
plt.savefig('results/figures/ntor_comparison.png', dpi=300)
print("å›¾è¡¨å·²ä¿å­˜: results/figures/ntor_comparison.pdf")
EOF
```

### é¢„æœŸæ•°æ®è¡¨æ ¼ï¼ˆè®ºæ–‡ä¸­ä½¿ç”¨ï¼‰

```
Table 1: Performance Comparison: Traditional Ntor vs PQ-Ntor

Operation                  Traditional    PQ-Ntor      Overhead
------------------------------------------------------------------
Client Create Onionskin    3.5 Î¼s        7.9 Î¼s       2.3Ã—
Server Create Reply        12.8 Î¼s       23.6 Î¼s      1.8Ã—
Client Finish Handshake    8.2 Î¼s        17.1 Î¼s      2.1Ã—
Full Handshake             24.5 Î¼s       48.9 Î¼s      2.0Ã—
------------------------------------------------------------------
Onionskin Size             84 bytes      820 bytes    9.8Ã—
Reply Size                 64 bytes      800 bytes    12.5Ã—
Cell Size                  512 bytes     2048 bytes   4.0Ã—
------------------------------------------------------------------
Security (Classical)       128-bit       128-bit      -
Security (Quantum)         0-bit         128-bit      âˆ
```

---

## å®éªŒ3: å¹¶å‘æ€§èƒ½æµ‹è¯•

### ç›®æ ‡
- æµ‹è¯•å¤šä¸ªå¹¶å‘ç”µè·¯çš„æ€§èƒ½
- è¯„ä¼°ç³»ç»Ÿå¯æ‰©å±•æ€§
- è¯†åˆ«æ€§èƒ½ç“¶é¢ˆ

### å®éªŒè„šæœ¬

```bash
#!/bin/bash
# experiments/run_concurrent_circuits.sh

RESULTS_DIR="results/concurrent"
mkdir -p $RESULTS_DIR

# å¯åŠ¨æœåŠ¡å™¨
./directory &
DIR_PID=$!
sleep 1

./relay -r guard -p 6001 &
GUARD_PID=$!
./relay -r middle -p 6002 &
MIDDLE_PID=$!
./relay -r exit -p 6003 &
EXIT_PID=$!
sleep 2

echo "æµ‹è¯•å¹¶å‘ç”µè·¯æ€§èƒ½..."

# æµ‹è¯•ä¸åŒå¹¶å‘çº§åˆ«
for concurrency in 1 5 10 20 50 100; do
    echo "Testing $concurrency concurrent circuits..."

    # å¯åŠ¨å¤šä¸ªå®¢æˆ·ç«¯
    start_time=$(date +%s.%N)

    for i in $(seq 1 $concurrency); do
        timeout 30 ./client http://127.0.0.1:8000/ > /dev/null 2>&1 &
    done

    # ç­‰å¾…æ‰€æœ‰å®Œæˆ
    wait

    end_time=$(date +%s.%N)
    elapsed=$(echo "$end_time - $start_time" | bc)
    throughput=$(echo "$concurrency / $elapsed" | bc -l)

    echo "$concurrency,$elapsed,$throughput" >> $RESULTS_DIR/concurrent.csv

    sleep 5  # å†·å´æ—¶é—´
done

# æ¸…ç†
kill $DIR_PID $GUARD_PID $MIDDLE_PID $EXIT_PID

# å¯è§†åŒ–
python3 << 'EOF'
import pandas as pd
import matplotlib.pyplot as plt

df = pd.read_csv('results/concurrent/concurrent.csv',
                 names=['Concurrency', 'Time', 'Throughput'])

fig, (ax1, ax2) = plt.subplots(1, 2, figsize=(14, 5))

# å®Œæˆæ—¶é—´
ax1.plot(df['Concurrency'], df['Time'], 'o-', linewidth=2, markersize=8)
ax1.set_xlabel('Concurrent Circuits', fontsize=12)
ax1.set_ylabel('Completion Time (s)', fontsize=12)
ax1.set_title('Circuit Construction Time vs Concurrency', fontsize=14)
ax1.grid(True, alpha=0.3)

# ååé‡
ax2.plot(df['Concurrency'], df['Throughput'], 's-', linewidth=2, markersize=8, color='green')
ax2.set_xlabel('Concurrent Circuits', fontsize=12)
ax2.set_ylabel('Throughput (circuits/s)', fontsize=12)
ax2.set_title('System Throughput vs Concurrency', fontsize=14)
ax2.grid(True, alpha=0.3)

plt.tight_layout()
plt.savefig('results/figures/concurrent_performance.pdf', dpi=300)
print("å›¾è¡¨å·²ä¿å­˜!")
EOF
```

---

## å®éªŒ4: ç½‘ç»œå»¶è¿Ÿå½±å“

### ç›®æ ‡
- æ¨¡æ‹ŸçœŸå®ç½‘ç»œæ¡ä»¶ï¼ˆLAN/WANï¼‰
- è¯„ä¼°PQ-Toråœ¨ä¸åŒç½‘ç»œå»¶è¿Ÿä¸‹çš„è¡¨ç°
- ä¸ä¼ ç»ŸTorå¯¹æ¯”

### å®éªŒè„šæœ¬

```bash
#!/bin/bash
# experiments/run_network_delay_test.sh

# éœ€è¦sudoæƒé™ä½¿ç”¨tc
if [ "$EUID" -ne 0 ]; then
    echo "è¯·ä½¿ç”¨sudoè¿è¡Œæ­¤è„šæœ¬"
    exit 1
fi

RESULTS_DIR="results/network_delay"
mkdir -p $RESULTS_DIR

# æµ‹è¯•ä¸åŒå»¶è¿Ÿ
DELAYS=(0 1 10 50 100 200)  # ms

echo "æµ‹è¯•ç½‘ç»œå»¶è¿Ÿå½±å“..."

for delay in "${DELAYS[@]}"; do
    echo "Setting delay: ${delay}ms"

    # è®¾ç½®ç½‘ç»œå»¶è¿Ÿï¼ˆloopbackï¼‰
    if [ $delay -gt 0 ]; then
        tc qdisc add dev lo root netem delay ${delay}ms
    fi

    # è¿è¡Œæµ‹è¯•
    ./test_network.sh > /dev/null 2>&1

    # è®°å½•æ—¶é—´ï¼ˆéœ€è¦ä¿®æ”¹test_network.shè¾“å‡ºæ—¶é—´ï¼‰
    # è¿™é‡Œå‡è®¾æœ‰æ—¶é—´è¾“å‡º
    echo "${delay},circuit_time,handshake_time" >> $RESULTS_DIR/delay_impact.csv

    # æ¸…é™¤å»¶è¿Ÿè®¾ç½®
    if [ $delay -gt 0 ]; then
        tc qdisc del dev lo root
    fi

    sleep 2
done

echo "æµ‹è¯•å®Œæˆï¼"

# å¯è§†åŒ–
python3 << 'EOF'
import pandas as pd
import matplotlib.pyplot as plt

# è¯»å–æ•°æ®
df = pd.read_csv('results/network_delay/delay_impact.csv',
                 names=['Delay(ms)', 'CircuitTime(ms)', 'HandshakeTime(us)'])

fig, ax = plt.subplots(figsize=(10, 6))

ax.plot(df['Delay(ms)'], df['CircuitTime(ms)'], 'o-',
        linewidth=2, markersize=8, label='3-Hop Circuit Construction')
ax.plot(df['Delay(ms)'], df['HandshakeTime(us)']/1000, 's-',
        linewidth=2, markersize=8, label='Single Handshake')

ax.set_xlabel('Network Delay (ms)', fontsize=12)
ax.set_ylabel('Time (ms)', fontsize=12)
ax.set_title('Impact of Network Latency on PQ-Tor Performance', fontsize=14)
ax.legend(fontsize=11)
ax.grid(True, alpha=0.3)

plt.tight_layout()
plt.savefig('results/figures/network_delay_impact.pdf', dpi=300)
print("å›¾è¡¨å·²ä¿å­˜!")
EOF
```

---

## å®éªŒ5: èµ„æºä½¿ç”¨åˆ†æ

### ç›®æ ‡
- æµ‹é‡å†…å­˜å ç”¨
- åˆ†æCPUä½¿ç”¨ç‡
- è¯†åˆ«æ€§èƒ½ç“¶é¢ˆ

### å®éªŒè„šæœ¬

```bash
#!/bin/bash
# experiments/run_resource_profiling.sh

RESULTS_DIR="results/profiling"
mkdir -p $RESULTS_DIR

echo "==================================="
echo "èµ„æºä½¿ç”¨åˆ†æ"
echo "==================================="

# 1. å†…å­˜åˆ†æ
echo "1. å†…å­˜åˆ†æï¼ˆä½¿ç”¨valgrind massifï¼‰..."
valgrind --tool=massif --massif-out-file=$RESULTS_DIR/relay.massif \
    ./relay -r middle -p 6002 &
RELAY_PID=$!

sleep 10
kill $RELAY_PID

ms_print $RESULTS_DIR/relay.massif > $RESULTS_DIR/relay_memory.txt
echo "   å†…å­˜åˆ†æå®Œæˆ: $RESULTS_DIR/relay_memory.txt"

# 2. CPUæ€§èƒ½åˆ†æ
echo "2. CPUæ€§èƒ½åˆ†æï¼ˆä½¿ç”¨perfï¼‰..."

# å¯åŠ¨æµ‹è¯•ç½‘ç»œ
./directory &
DIR_PID=$!
./relay -r guard -p 6001 &
GUARD_PID=$!
./relay -r middle -p 6002 &
MIDDLE_PID=$!
./relay -r exit -p 6003 &
EXIT_PID=$!

sleep 2

# ä½¿ç”¨perfè®°å½•
perf stat -d -o $RESULTS_DIR/perf_stats.txt \
    ./client http://127.0.0.1:8000/

kill $DIR_PID $GUARD_PID $MIDDLE_PID $EXIT_PID

echo "   CPUåˆ†æå®Œæˆ: $RESULTS_DIR/perf_stats.txt"

# 3. è¿è¡Œæ—¶ç›‘æ§
echo "3. è¿è¡Œæ—¶èµ„æºç›‘æ§..."

./directory &
DIR_PID=$!
./relay -r guard -p 6001 &
GUARD_PID=$!
./relay -r middle -p 6002 &
MIDDLE_PID=$!
./relay -r exit -p 6003 &
EXIT_PID=$!

# ç›‘æ§30ç§’
for i in {1..30}; do
    ps -p $GUARD_PID -o %cpu,%mem,rss >> $RESULTS_DIR/runtime_guard.txt
    ps -p $MIDDLE_PID -o %cpu,%mem,rss >> $RESULTS_DIR/runtime_middle.txt
    ps -p $EXIT_PID -o %cpu,%mem,rss >> $RESULTS_DIR/runtime_exit.txt
    sleep 1
done

kill $DIR_PID $GUARD_PID $MIDDLE_PID $EXIT_PID

echo "==================================="
echo "èµ„æºåˆ†æå®Œæˆï¼"
echo "ç»“æœä¿å­˜åœ¨: $RESULTS_DIR/"
echo "==================================="
```

---

## å®éªŒ6: ä¸åŒPQç®—æ³•å¯¹æ¯”

### ç›®æ ‡
- å¯¹æ¯”Kyber-512/768/1024
- ï¼ˆå¯é€‰ï¼‰å¯¹æ¯”å…¶ä»–PQ KEMï¼ˆSaber, NTRUï¼‰
- éªŒè¯Kyber-512çš„é€‰æ‹©åˆç†æ€§

### å®ç°è¦ç‚¹

```c
// ä¿®æ”¹kyber_kem.cï¼Œæ”¯æŒç®—æ³•åˆ‡æ¢
#define PQ_ALGORITHM "Kyber512"  // or "Kyber768", "Kyber1024"

// åˆ›å»ºå¯¹æ¯”æµ‹è¯•
// benchmark/benchmark_algorithms.c
void test_algorithm(const char *alg_name) {
    // åˆ‡æ¢ç®—æ³•
    // è¿è¡Œbenchmark
    // æ”¶é›†æ•°æ®
}

int main() {
    const char *algorithms[] = {
        "Kyber512", "Kyber768", "Kyber1024"
    };

    for (int i = 0; i < 3; i++) {
        test_algorithm(algorithms[i]);
    }

    // ç”Ÿæˆå¯¹æ¯”è¡¨æ ¼
}
```

### é¢„æœŸå¯¹æ¯”è¡¨æ ¼

```
Table: Performance Comparison of Different PQ Algorithms

Algorithm    Security  PK Size  CT Size  Encap   Decap   Handshake
                Level   (bytes)  (bytes)  (Î¼s)    (Î¼s)    (Î¼s)
--------------------------------------------------------------------
Kyber-512    Level 1   800      768      12.3    8.7     48.9
Kyber-768    Level 3   1184     1088     17.8    12.4    68.5
Kyber-1024   Level 5   1568     1568     25.2    17.1    94.3
--------------------------------------------------------------------
```

---

## å®éªŒ7: ç«¯åˆ°ç«¯ååé‡æµ‹è¯•

### ç›®æ ‡
- æµ‹è¯•å¤§æ–‡ä»¶ä¼ è¾“æ€§èƒ½
- è¯„ä¼°å®é™…åº”ç”¨åœºæ™¯

### å®éªŒè„šæœ¬

```bash
#!/bin/bash
# experiments/run_throughput_test.sh

RESULTS_DIR="results/throughput"
mkdir -p $RESULTS_DIR

# åˆ›å»ºæµ‹è¯•æ–‡ä»¶
dd if=/dev/urandom of=/tmp/test_file_1MB bs=1M count=1
dd if=/dev/urandom of=/tmp/test_file_10MB bs=1M count=10
dd if=/dev/urandom of=/tmp/test_file_100MB bs=1M count=100

# å¯åŠ¨æµ‹è¯•æœåŠ¡å™¨ï¼ˆä¿®æ”¹ä¸ºæä¾›æ–‡ä»¶ä¸‹è½½ï¼‰
# å¯åŠ¨Torç½‘ç»œ
# ...

# æµ‹è¯•ä¸åŒæ–‡ä»¶å¤§å°
for size in 1 10 100; do
    echo "Testing ${size}MB file transfer..."

    start=$(date +%s.%N)
    ./client http://127.0.0.1:8000/test_file_${size}MB > /dev/null
    end=$(date +%s.%N)

    elapsed=$(echo "$end - $start" | bc)
    throughput=$(echo "$size / $elapsed" | bc -l)

    echo "${size},${elapsed},${throughput}" >> $RESULTS_DIR/throughput.csv
done
```

---

## ğŸ“Š æ•°æ®æ•´ç†ä¸å¯è§†åŒ–

### ç»Ÿä¸€æ•°æ®æ ¼å¼

```python
# scripts/process_all_data.py
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns

# è®¾ç½®ç»˜å›¾é£æ ¼
sns.set_style("whitegrid")
plt.rcParams['figure.dpi'] = 300

# 1. å¤„ç†æ¡æ‰‹æ€§èƒ½æ•°æ®
def process_handshake_data():
    # ...

# 2. å¤„ç†å¹¶å‘æ€§èƒ½æ•°æ®
def process_concurrent_data():
    # ...

# 3. ç”Ÿæˆæ‰€æœ‰è®ºæ–‡å›¾è¡¨
def generate_all_figures():
    # Figure 1: Handshake latency CDF
    # Figure 2: Size comparison
    # Figure 3: Concurrent performance
    # Figure 4: Network delay impact
    # ...
```

---

## âœ… å®éªŒå®Œæˆæ£€æŸ¥æ¸…å•

### æ ¸å¿ƒå®éªŒï¼ˆå¿…é¡»å®Œæˆï¼‰
- [ ] å¤§è§„æ¨¡ç»Ÿè®¡æµ‹è¯•ï¼ˆ10 runs Ã— 10kï¼‰
- [ ] ä¼ ç»ŸTorå¯¹æ¯”å®ç°ä¸æµ‹è¯•
- [ ] å¹¶å‘æ€§èƒ½æµ‹è¯•ï¼ˆ1/5/10/20/50/100ï¼‰
- [ ] åŸºæœ¬èµ„æºä½¿ç”¨åˆ†æ

### å¯é€‰å®éªŒï¼ˆå¼ºçƒˆæ¨èï¼‰
- [ ] ç½‘ç»œå»¶è¿Ÿå½±å“æµ‹è¯•
- [ ] ä¸åŒPQç®—æ³•å¯¹æ¯”
- [ ] ç«¯åˆ°ç«¯ååé‡æµ‹è¯•

### æ•°æ®æ•´ç†
- [ ] æ‰€æœ‰åŸå§‹æ•°æ®CSVæ ¼å¼ä¿å­˜
- [ ] ç»Ÿè®¡åˆ†æï¼ˆå‡å€¼ã€æ ‡å‡†å·®ã€ç½®ä¿¡åŒºé—´ï¼‰
- [ ] å›¾è¡¨ç”Ÿæˆï¼ˆPDF + PNGï¼‰
- [ ] æ•°æ®éªŒè¯å’Œä¸€è‡´æ€§æ£€æŸ¥

---

## ğŸ“ å®éªŒç»“æœç›®å½•ç»“æ„

```
results/
â”œâ”€â”€ large_scale/
â”‚   â”œâ”€â”€ run_1.csv ... run_10.csv
â”‚   â””â”€â”€ summary.txt
â”œâ”€â”€ traditional_vs_pq/
â”‚   â”œâ”€â”€ traditional_ntor.csv
â”‚   â”œâ”€â”€ pq_ntor.csv
â”‚   â””â”€â”€ comparison.csv
â”œâ”€â”€ concurrent/
â”‚   â”œâ”€â”€ concurrent.csv
â”‚   â””â”€â”€ analysis.txt
â”œâ”€â”€ network_delay/
â”‚   â”œâ”€â”€ delay_impact.csv
â”‚   â””â”€â”€ analysis.txt
â”œâ”€â”€ profiling/
â”‚   â”œâ”€â”€ relay.massif
â”‚   â”œâ”€â”€ relay_memory.txt
â”‚   â”œâ”€â”€ perf_stats.txt
â”‚   â””â”€â”€ runtime_*.txt
â”œâ”€â”€ algorithms/
â”‚   â”œâ”€â”€ kyber512.csv
â”‚   â”œâ”€â”€ kyber768.csv
â”‚   â””â”€â”€ kyber1024.csv
â”œâ”€â”€ throughput/
â”‚   â””â”€â”€ throughput.csv
â””â”€â”€ figures/               # æ‰€æœ‰è®ºæ–‡å›¾è¡¨
    â”œâ”€â”€ handshake_cdf.pdf
    â”œâ”€â”€ size_comparison.pdf
    â”œâ”€â”€ concurrent_performance.pdf
    â”œâ”€â”€ network_delay_impact.pdf
    â”œâ”€â”€ algorithm_comparison.pdf
    â””â”€â”€ ...
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

```bash
# 1. åˆ›å»ºå®éªŒç›®å½•
mkdir -p experiments results/figures

# 2. è¿è¡Œæ ¸å¿ƒå®éªŒ
cd experiments
./run_large_scale_benchmark.sh
./compare_traditional_vs_pq.sh
./run_concurrent_circuits.sh

# 3. å¤„ç†æ•°æ®
python3 scripts/process_all_data.py

# 4. æ£€æŸ¥ç»“æœ
ls -lh results/figures/
```

---

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **å®éªŒå¯é‡å¤æ€§**
   - è®°å½•ç¡¬ä»¶é…ç½®ï¼ˆCPUå‹å·ã€ä¸»é¢‘ã€æ ¸å¿ƒæ•°ï¼‰
   - è®°å½•è½¯ä»¶ç‰ˆæœ¬ï¼ˆGCCã€liboqsã€OpenSSLï¼‰
   - æ¯æ¬¡å®éªŒå‰é‡å¯ï¼Œç¡®ä¿ç³»ç»ŸçŠ¶æ€ä¸€è‡´

2. **CPUé¢‘ç‡å›ºå®š**
   ```bash
   # å›ºå®šCPUé¢‘ç‡ï¼Œé¿å…åŠ¨æ€è°ƒé¢‘å½±å“
   sudo cpupower frequency-set -g performance
   ```

3. **å…³é—­ä¸å¿…è¦çš„æœåŠ¡**
   ```bash
   # å‡å°‘èƒŒæ™¯å™ªå£°
   sudo systemctl stop cron
   sudo systemctl stop bluetooth
   ```

4. **å¤šæ¬¡è¿è¡Œ**
   - å…³é”®å®éªŒè‡³å°‘è¿è¡Œ3æ¬¡
   - æŠ¥å‘Šä¸­ä½æ•°æˆ–å¹³å‡å€¼+ç½®ä¿¡åŒºé—´

5. **æ•°æ®å¤‡ä»½**
   - åŸå§‹æ•°æ®ç«‹å³å¤‡ä»½
   - ä½¿ç”¨gitç®¡ç†å®éªŒè„šæœ¬å’Œç»“æœ

---

**é¢„è®¡æ€»æ—¶é—´**: 2-3å‘¨ï¼ˆæ ¹æ®ä¼˜å…ˆçº§é€‰æ‹©å®éªŒï¼‰
**æ ¸å¿ƒå®éªŒ**: 1å‘¨å¯å®Œæˆæœ€é‡è¦çš„3ä¸ªå®éªŒ

ç¥å®éªŒé¡ºåˆ©ï¼ğŸ”¬
