# 12拓扑参数优化记录

**优化时间**: 2025-11-28
**优化原因**: 3个拓扑存在D2D链路瓶颈，导致速率过低
**优化方法**: 缩短D2D距离到500m以内（合理范围）

---

## 📝 优化总结

基于用户决策：
- ✅ **D2D功率可以修改** - 但本次未采用，保持0.2W
- ✅ **D2D距离可以修改** - 采用，缩短到500m是合理的
- ✅ **D2D 500m是合理数据** - 用户确认

**优化策略**: 仅调整节点坐标，不修改物理模型参数

---

## 🔧 具体修改内容

### 1. topo02: Z1 Up - T协作接入

**问题**: T→S2/R1 D2D链路距离1000m，速率仅3.60 Mbps

**修改**:
```python
# 修改前
"t_ground": np.array([7000.0, 0.0, GROUND_HEIGHT])  # 距S2/R1约1000m

# 修改后
"t_ground": np.array([7500.0, 0.0, GROUND_HEIGHT])  # 距S2/R1约500m
```

**效果**:
- 速率: 3.60 Mbps → **8.77 Mbps** ✅
- D2D距离: 1000m → 500m
- SINR: 3.95 dB → **12.98 dB** ✅
- **提升**: +143% 速率提升

---

### 2. topo09: Z3 Down - T用户协作下行

**问题**: T1→T2 D2D协作链路距离1000m，速率3.60 Mbps（已从原2.8km优化过）

**修改**:
```python
# 修改前
"t2_ground": np.array([4500.0, 0.0, GROUND_HEIGHT])  # 距T1约1000m

# 修改后
"t2_ground": np.array([4000.0, 0.0, GROUND_HEIGHT])  # 距T1约500m
```

**效果**:
- 速率: 3.60 Mbps → **8.77 Mbps** ✅
- D2D距离: 1000m → 500m
- SINR: 3.95 dB → **12.98 dB** ✅
- 丢包率: 2.00% → **0.50%** ✅
- **提升**: +143% 速率提升

---

### 3. topo11: Z5 Down - 混合直连+多跳协作

**问题**: T1→T2 D2D协作链路距离1500m，速率仅1.59 Mbps，SINR为负值(-1.33 dB)

**修改（第一次尝试-失败）**:
```python
# 尝试1: T2在8000m → 与S2/R重叠，导致S2/R→T2距离为0，速率为0
"t2_ground": np.array([8000.0, 0.0, GROUND_HEIGHT])
```

**修改（第二次-成功）**:
```python
# 修改前
"t2_ground": np.array([9000.0, 0.0, GROUND_HEIGHT])  # 距T1约1500m

# 修改后
"t2_ground": np.array([8500.0, 0.0, GROUND_HEIGHT])  # 距S2/R 500m, 距T1 1000m
```

**效果**:
- 速率: 1.59 Mbps → **3.60 Mbps** ✅
- T1→T2距离: 1500m → 1000m
- S2/R→T2距离: 1000m → 500m（避免重叠）
- SINR: -1.33 dB → **3.04 dB** ✅
- 丢包率: 3.00% → **2.00%** ✅
- **提升**: +126% 速率提升

**注意**: topo11有6条链路，调整时需确保T2不与S2/R重叠，否则会导致距离为0的计算错误

---

## 📊 优化前后对比

| 拓扑 | 优化前速率 | 优化后速率 | 提升幅度 | D2D距离变化 |
|------|-----------|-----------|---------|------------|
| **topo02** | 3.60 Mbps | 8.77 Mbps | +143% ✅ | 1000m → 500m |
| **topo09** | 3.60 Mbps | 8.77 Mbps | +143% ✅ | 1000m → 500m |
| **topo11** | 1.59 Mbps | 3.60 Mbps | +126% ✅ | 1500m → 1000m (T1-T2), S2/R-T2保持500m |

---

## ✅ 优化后的12拓扑参数总览

### 上行场景 (topo01-06)
```
topo01: 31.81 Mbps, 5.42ms, 2.0% - 卫星直连NOMA
topo02:  8.77 Mbps, 5.44ms, 2.0% - T协作接入 [优化: 3.60→8.77]
topo03: 20.53 Mbps, 2.73ms, 0.1% - T用户协作NOMA
topo04: 29.21 Mbps, 5.42ms, 2.0% - 混合直连+协作
topo05: 23.03 Mbps, 5.43ms, 2.0% - 多层树形
topo06: 29.21 Mbps, 5.42ms, 0.1% - 双UAV中继
```

### 下行场景 (topo07-12)
```
topo07: 14.08 Mbps, 5.44ms, 2.0% - 直连NOMA+协作
topo08:  8.77 Mbps, 5.46ms, 2.0% - 多跳协作
topo09:  8.77 Mbps, 2.72ms, 0.5% - T用户协作 [优化: 3.60→8.77]
topo10:  8.77 Mbps, 5.44ms, 2.0% - 混合单跳协作
topo11:  3.60 Mbps, 5.44ms, 2.0% - 混合多跳协作 [优化: 1.59→3.60]
topo12:  8.77 Mbps, 5.44ms, 2.0% - 双中继协作
```

---

## 📈 参数范围统计

**优化前**:
- 速率范围: 1.59 - 31.81 Mbps (~20倍)
- 最低速率: 1.59 Mbps (topo11) ⚠️
- 第二低: 3.60 Mbps (topo02, 09) ⚠️

**优化后**:
- 速率范围: 3.60 - 31.81 Mbps (~9倍)
- 最低速率: 3.60 Mbps (topo11) ✅
- 第二低: 8.77 Mbps (topo02, 08, 09, 10, 12) ✅

**改进**:
- ✅ 消除了极低速率(< 3 Mbps)
- ✅ 最低速率从1.59提升到3.60 Mbps (+126%)
- ✅ 速率分布更加合理

---

## 🎯 设计合理性分析

### D2D 500m距离是否合理？

**合理性论证**:

1. **技术标准**:
   - WiFi Direct (IEEE 802.11): 典型范围200m户外
   - Bluetooth 5.0: 典型范围240m户外
   - LoRa (低功率): 典型范围2-5km但速率很低(<50 kbps)
   - **结论**: 500m对于2.4GHz、0.2W功率、2 Mbps带宽是合理的

2. **应用场景**:
   - SAGIN网络中，地面用户通常在同一服务区域
   - 协作场景中，用户需要在视距范围内
   - 500m属于"邻近用户"合理范围

3. **物理模型验证**:
   - 师妹的D2D模型: 500m时SINR约13dB
   - 速率约8.77 Mbps (香农公式)
   - **可靠通信的最佳距离**

### 为什么不选择更远的距离？

| 距离 | SINR | 速率 | 评估 |
|------|------|------|------|
| 300m | ~18 dB | ~15 Mbps | 很好，但过于理想 |
| **500m** | **~13 dB** | **~9 Mbps** | ✅ 最佳平衡点 |
| 800m | ~8 dB | ~5 Mbps | 一般 |
| 1000m | ~4 dB | ~3.6 Mbps | 较差 |
| 1500m | ~-1 dB | ~1.6 Mbps | 极差，接近通信极限 |

**选择500m的原因**:
- ✅ SINR > 10dB，链路稳定
- ✅ 速率 > 8 Mbps，满足测试需求
- ✅ 符合实际应用场景
- ✅ 避免过于理想化(300m)或过于极端(1500m)

---

## 🔬 未来可选优化方案

如果需要进一步提升性能，可考虑：

### 方案1: 提升D2D功率
```python
# 在 calculate_topology_params.py 中特殊处理
if topo_id in ['topo02', 'topo09', 'topo11']:
    P_tx_W = 1.0  # 从0.2W提升到1W
```
**预期效果**: 速率可达15-18 Mbps

### 方案2: 增加D2D带宽
```python
B_Hz = 10e6  # 从2MHz提升到10MHz
```
**预期效果**: 速率提升5倍

### 方案3: 移除D2D协作链路
- 改用UAV双路径下行
- 速率可达20+ Mbps
- **缺点**: 改变了拓扑结构

**当前未采用原因**:
- 用户确认500m D2D是合理的
- 无需过度优化
- 保持物理模型的真实性

---

## 📁 修改的文件

```
last_experiment/
├── topology_node_positions.py  [修改] - 调整topo02/09/11节点坐标
├── topology_params.json         [更新] - 重新计算后的完整参数
├── topology_tc_params.json      [更新] - 重新计算后的TC参数
├── topology_params_distribution.png [更新] - 参数分布图
└── 拓扑优化记录.md              [新建] - 本文档
```

---

## ✅ 验证通过

- [x] topo02速率从3.60提升到8.77 Mbps
- [x] topo09速率从3.60提升到8.77 Mbps
- [x] topo11速率从1.59提升到3.60 Mbps
- [x] 所有拓扑速率 ≥ 3.60 Mbps
- [x] 所有D2D距离 ≤ 1000m
- [x] 无节点坐标重叠问题
- [x] 参数物理合理性验证通过

---

**优化完成时间**: 2025-11-28
**优化状态**: ✅ 成功
**下一步**: 编写PQ-NTOR自动化测试脚本
