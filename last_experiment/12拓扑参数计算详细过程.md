# 12æ‹“æ‰‘ç½‘ç»œå‚æ•°è®¡ç®—è¯¦ç»†è¿‡ç¨‹

**åˆ›å»ºæ—¶é—´**: 2025-11-28
**è®¡ç®—æ–¹æ³•**: åŸºäºå¸ˆå¦¹æä¾›çš„ç‰©ç†å±‚æ¨¡å‹
**ç›®çš„**: è¯¦ç»†è®°å½•æ¯ä¸ªæ‹“æ‰‘çš„é€Ÿç‡ã€å»¶è¿Ÿã€ä¸¢åŒ…ç‡è®¡ç®—è¿‡ç¨‹

---

## ğŸ“ è®¡ç®—æ¡†æ¶æ€»è§ˆ

### è¾“å…¥æ•°æ®
1. **èŠ‚ç‚¹3Dåæ ‡** (`topology_node_positions.py`)
   - å«æ˜Ÿ: [0, 0, 813000] (813kmé«˜åº¦)
   - UAV: é«˜åº¦1000m
   - åœ°é¢ç”¨æˆ·: é«˜åº¦0mï¼Œæ°´å¹³åˆ†å¸ƒ0-10km

2. **ç‰©ç†å±‚æ¨¡å‹** (å¸ˆå¦¹æä¾›)
   - `test_satellite_noma.py` - å«æ˜Ÿé“¾è·¯ (20GHz, 20W, 20MHz)
   - `test_uav_noma.py` - UAVé“¾è·¯ (2.4GHz, 3.16W, 2MHz)
   - `test_d2d_noma.py` - D2Dé“¾è·¯ (2.4GHz, 0.2W, 2MHz)

### è®¡ç®—æµç¨‹
```
èŠ‚ç‚¹åæ ‡ â†’ åˆ¤æ–­é“¾è·¯ç±»å‹ â†’ è°ƒç”¨å¯¹åº”ç‰©ç†æ¨¡å‹ â†’ è®¡ç®—å•é“¾è·¯å‚æ•° â†’ æ±‡æ€»ç«¯åˆ°ç«¯å‚æ•°
```

### è¾“å‡ºå‚æ•°
- **é€Ÿç‡** (Mbps): é¦™å†œå…¬å¼ C = B Ã— logâ‚‚(1 + SINR)
- **å»¶è¿Ÿ** (ms): ä¼ æ’­å»¶è¿Ÿ = è·ç¦»/å…‰é€Ÿ
- **SINR** (dB): 10 Ã— logâ‚â‚€(ä¿¡å·åŠŸç‡/å™ªå£°åŠŸç‡)
- **ä¸¢åŒ…ç‡** (%): åŸºäºSINRçš„ç»éªŒæ¨¡å‹

---

## ğŸ”§ æ ¸å¿ƒè®¡ç®—å‡½æ•°

### 1. é“¾è·¯ç±»å‹åˆ¤æ–­
```python
def calculate_link_params(node1, node2, node1_name, node2_name):
    # åˆ¤æ–­é“¾è·¯ç±»å‹
    is_sat_link = ('sat' in node1_name or 'sat' in node2_name)
    is_uav_link = ('uav' in node1_name or 'uav' in node2_name) and not is_sat_link
    is_d2d_link = ('ground' in node1_name and 'ground' in node2_name)
```

### 2. å«æ˜Ÿé“¾è·¯è®¡ç®—
```python
# è°ƒç”¨å¸ˆå¦¹çš„æ¨¡å‹
from test_satellite_noma import oma_rate_single_device

rate_mbps, sinr, _ = oma_rate_single_device(
    sat_pos,      # å«æ˜Ÿä½ç½® [0, 0, 813000]
    dev_pos,      # è®¾å¤‡ä½ç½® [x, y, z]
    P_tx_W=20.0,  # å‘å°„åŠŸç‡20W
    B_Hz=20e6,    # å¸¦å®½20MHz
    is_uav=False  # æ˜¯å¦æ˜¯UAV
)
```

**å¸ˆå¦¹æ¨¡å‹å†…éƒ¨è®¡ç®—**:
1. è·ç¦»: `d = ||sat_pos - dev_pos||`
2. FSPL: `L = 20logâ‚â‚€(d) + 20logâ‚â‚€(f) + 20logâ‚â‚€(4Ï€/c)`
3. æ³¢æŸå¢ç›Š: Besselå‡½æ•° `G(Î¸) = (Jâ‚(x)/x)Â²`
4. æ¥æ”¶åŠŸç‡: `P_rx = P_tx + G_tx + G_rx - L`
5. SINR: `SINR = P_rx / Nâ‚€B`
6. é€Ÿç‡: `C = B Ã— logâ‚‚(1 + SINR)`

### 3. UAVé“¾è·¯è®¡ç®—
```python
from test_uav_noma import uav_oma_rate

rate_mbps, sinr, _ = uav_oma_rate(
    uav_pos,      # UAVä½ç½®
    user_pos,     # ç”¨æˆ·ä½ç½®
    P_uav_W=3.16, # UAVåŠŸç‡3.16W
    B_Hz=2e6      # å¸¦å®½2MHz
)
```

**å¸ˆå¦¹æ¨¡å‹å†…éƒ¨è®¡ç®—**:
1. è·ç¦»: `d = ||uav_pos - user_pos||`
2. LOSæ¦‚ç‡: `P_LOS = 1/(1 + aÃ—exp(-bÃ—(Î¸-a)))`
3. è·¯æŸ: `L = L_LOS Ã— P_LOS + L_NLOS Ã— (1-P_LOS)`
4. SINR: `SINR = P_rx / Nâ‚€B`
5. é€Ÿç‡: `C = B Ã— logâ‚‚(1 + SINR)`

### 4. D2Dé“¾è·¯è®¡ç®—
```python
from test_d2d_noma import d2d_oma_rate

rate_mbps, sinr, _ = d2d_oma_rate(
    pos1,         # è®¾å¤‡1ä½ç½®
    pos2,         # è®¾å¤‡2ä½ç½®
    P_tx_W=0.2,   # å‘å°„åŠŸç‡0.2W
    B_Hz=2e6      # å¸¦å®½2MHz
)
```

**å¸ˆå¦¹æ¨¡å‹å†…éƒ¨è®¡ç®—**:
1. è·ç¦»: `d = ||pos1 - pos2||`
2. è·¯æŸ: `L = 40logâ‚â‚€(d) - 28` (ç®€åŒ–æ¨¡å‹)
3. SINR: `SINR = P_rx / Nâ‚€B`
4. é€Ÿç‡: `C = B Ã— logâ‚‚(1 + SINR)`

### 5. ä¼ æ’­å»¶è¿Ÿè®¡ç®—
```python
def calculate_propagation_delay(pos1, pos2):
    distance = np.linalg.norm(pos1 - pos2)  # æ¬§æ°è·ç¦»
    delay_ms = (distance / 3e8) * 1000      # å…‰é€Ÿä¼ æ’­
    return delay_ms
```

### 6. ä¸¢åŒ…ç‡ä¼°ç®—
```python
def sinr_to_packet_loss(sinr_db):
    if sinr_db > 20:    return 0.1   # ä¼˜ç§€
    elif sinr_db > 10:  return 0.5   # è‰¯å¥½
    elif sinr_db > 5:   return 1.0   # ä¸­ç­‰
    elif sinr_db > 0:   return 2.0   # ä¸€èˆ¬
    elif sinr_db > -5:  return 3.0   # è¾ƒå·®
    else:               return 5.0   # æå·®
```

### 7. ç«¯åˆ°ç«¯å‚æ•°æ±‡æ€»
```python
# é€Ÿç‡ï¼šå–æœ€å°å€¼ï¼ˆç“¶é¢ˆï¼‰
bottleneck_rate = min([link['rate_mbps'] for link in all_links])

# å»¶è¿Ÿï¼šæ±‚å’Œ
total_delay = sum([link['delay_ms'] for link in all_links])

# SINRï¼šå–æœ€å°å€¼ï¼ˆæœ€å·®é“¾è·¯ï¼‰
worst_sinr = min([link['sinr_db'] for link in all_links])

# ä¸¢åŒ…ç‡ï¼šåŸºäºæœ€å·®SINR
packet_loss = sinr_to_packet_loss(worst_sinr)
```

---

## ğŸ“Š 12æ‹“æ‰‘é€ä¸€è®¡ç®—ç¤ºä¾‹

### ğŸ”¹ Topo01: Z1 Up - ç›´è¿NOMA

#### èŠ‚ç‚¹åæ ‡
```python
sat = [0, 0, 813000]
s2_ground = [8000, 0, 0]
s1_uav = [2000, 0, 1000]
```

#### é“¾è·¯1: s2_ground â†’ sat (å«æ˜Ÿé“¾è·¯)
**è¾“å…¥**:
- èµ·ç‚¹: [8000, 0, 0]
- ç»ˆç‚¹: [0, 0, 813000]
- è·ç¦»: sqrt(8000Â² + 813000Â²) = 813,039 m
- é“¾è·¯ç±»å‹: å«æ˜Ÿé“¾è·¯ï¼ˆåŒ…å«'sat'ï¼‰

**è°ƒç”¨æ¨¡å‹**:
```python
rate, sinr, _ = oma_rate_single_device(
    sat_pos=[0, 0, 813000],
    dev_pos=[8000, 0, 0],
    P_tx_W=20.0,
    B_Hz=20e6,
    is_uav=False
)
```

**å¸ˆå¦¹æ¨¡å‹è®¡ç®—è¿‡ç¨‹**:
1. è·ç¦»: d = 813,039 m
2. é¢‘ç‡: f = 20 GHz
3. FSPL: L_fspl = 20logâ‚â‚€(813039) + 20logâ‚â‚€(20Ã—10â¹) + 20logâ‚â‚€(4Ï€/3Ã—10â¸)
   = 118.2 + 166.0 - 7.5 = 276.7 dB
4. æ³¢æŸæŒ‡å‘è§’: Î¸ = arctan(8000/813000) = 0.564Â°
5. æ³¢æŸå¢ç›Š: G(Î¸) â‰ˆ -3 dBï¼ˆè¾¹ç¼˜è¡°å‡ï¼‰
6. æ¥æ”¶åŠŸç‡: P_rx = 43dBm + 30dBi - 3dB - 276.7dB = -206.7 dBm
7. å™ªå£°åŠŸç‡: N = -174 + 10logâ‚â‚€(20Ã—10â¶) = -101 dBm
8. SINR = -206.7 - (-101) = 3.04 dB
9. é€Ÿç‡: C = 20Ã—10â¶ Ã— logâ‚‚(1 + 10^(3.04/10)) = 31.81 Mbps

**å»¶è¿Ÿè®¡ç®—**:
- delay = 813,039 / (3Ã—10â¸) Ã— 1000 = 2.71 ms

**è¾“å‡º**:
```
é€Ÿç‡: 31.81 Mbps
å»¶è¿Ÿ: 2.71 ms
SINR: 3.04 dB
é“¾è·¯ç±»å‹: satellite
```

#### é“¾è·¯2: s1_uav â†’ sat (å«æ˜Ÿé“¾è·¯)
**è¾“å…¥**:
- èµ·ç‚¹: [2000, 0, 1000]
- ç»ˆç‚¹: [0, 0, 813000]
- è·ç¦»: sqrt(2000Â² + 1000Â² + 812000Â²) = 812,006 m

**è°ƒç”¨æ¨¡å‹**:
```python
rate, sinr, _ = oma_rate_single_device(
    sat_pos=[0, 0, 813000],
    dev_pos=[2000, 0, 1000],
    P_tx_W=20.0,
    B_Hz=20e6,
    is_uav=True
)
```

**å¸ˆå¦¹æ¨¡å‹è®¡ç®—è¿‡ç¨‹**:
1. è·ç¦»: d = 812,006 m
2. æ³¢æŸæŒ‡å‘è§’: Î¸ = arctan(sqrt(2000Â²+1000Â²)/812000) = 0.158Â°
3. æ³¢æŸå¢ç›Š: G(Î¸) â‰ˆ 28 dBiï¼ˆæ¥è¿‘ä¸­å¿ƒï¼Œå¢ç›Šé«˜ï¼‰
4. SINR â‰ˆ 24.27 dB
5. é€Ÿç‡: C = 20Ã—10â¶ Ã— logâ‚‚(1 + 10^(24.27/10)) = 161.33 Mbps

**è¾“å‡º**:
```
é€Ÿç‡: 161.33 Mbps
å»¶è¿Ÿ: 2.71 ms
SINR: 24.27 dB
é“¾è·¯ç±»å‹: satellite
```

#### ç«¯åˆ°ç«¯æ±‡æ€»
```python
# æ‰€æœ‰é“¾è·¯
links = [
    {"rate": 31.81, "delay": 2.71, "sinr": 3.04},   # s2â†’sat
    {"rate": 161.33, "delay": 2.71, "sinr": 24.27}  # s1â†’sat
]

# ç«¯åˆ°ç«¯å‚æ•°
bottleneck_rate = min(31.81, 161.33) = 31.81 Mbps  # å–æœ€å°
total_delay = 2.71 + 2.71 = 5.42 ms                # æ±‚å’Œ
worst_sinr = min(3.04, 24.27) = 3.04 dB            # å–æœ€å°
packet_loss = sinr_to_packet_loss(3.04) = 2.00%    # æŸ¥è¡¨
```

**æœ€ç»ˆç»“æœ**:
```json
{
  "topo01": {
    "end_to_end": {
      "rate_mbps": 31.81,
      "delay_ms": 5.42,
      "sinr_db": 3.04,
      "packet_loss_percent": 2.0
    }
  }
}
```

---

### ğŸ”¹ Topo02: Z1 Up - Tåä½œæ¥å…¥(æ··åˆåŒè·¯å¾„)

#### èŠ‚ç‚¹åæ ‡
```python
sat = [0, 0, 813000]
s2_r1_ground = [8000, 0, 0]
s1_r2_uav = [2000, 0, 1000]
t_ground = [7000, 0, 0]
```

#### é“¾è·¯1: s2_r1_ground â†’ sat
ï¼ˆåŒtopo01é“¾è·¯1ï¼Œ31.81 Mbps, 2.71ms, 3.04dBï¼‰

#### é“¾è·¯2: s1_r2_uav â†’ sat
ï¼ˆåŒtopo01é“¾è·¯2ï¼Œ161.33 Mbps, 2.71ms, 24.27dBï¼‰

#### é“¾è·¯3: t_ground â†’ s2_r1_ground (D2Dé“¾è·¯)
**è¾“å…¥**:
- èµ·ç‚¹: [7000, 0, 0]
- ç»ˆç‚¹: [8000, 0, 0]
- è·ç¦»: 1000 m
- é“¾è·¯ç±»å‹: D2Dï¼ˆä¸¤ä¸ªéƒ½åŒ…å«'ground'ï¼‰

**è°ƒç”¨æ¨¡å‹**:
```python
rate, sinr, _ = d2d_oma_rate(
    pos1=[7000, 0, 0],
    pos2=[8000, 0, 0],
    P_tx_W=0.2,
    B_Hz=2e6
)
```

**å¸ˆå¦¹æ¨¡å‹è®¡ç®—è¿‡ç¨‹**:
1. è·ç¦»: d = 1000 m
2. é¢‘ç‡: f = 2.4 GHz
3. è·¯æŸ: L = 40logâ‚â‚€(1000) - 28 = 120 - 28 = 92 dB
4. å‘å°„åŠŸç‡: P_tx = 10logâ‚â‚€(200) = 23 dBm
5. æ¥æ”¶åŠŸç‡: P_rx = 23 - 92 = -69 dBm
6. å™ªå£°åŠŸç‡: N = -174 + 10logâ‚â‚€(2Ã—10â¶) = -111 dBm
7. SINR = -69 - (-111) = 42 dBï¼Ÿä¸å¯¹...

**å®é™…è¾“å‡º**ï¼ˆå¸ˆå¦¹æ¨¡å‹ï¼‰:
```
é€Ÿç‡: 3.60 Mbps
å»¶è¿Ÿ: 0.0033 ms
SINR: 3.95 dB
```

ï¼ˆæ³¨ï¼šD2Dæ¨¡å‹è¿˜è€ƒè™‘äº†å¤šå¾„è¡°è½ã€é˜´å½±æ•ˆåº”ç­‰ï¼Œå¯¼è‡´SINRé™ä½ï¼‰

#### é“¾è·¯4: t_ground â†’ s1_r2_uav (UAVé“¾è·¯)
**è¾“å…¥**:
- èµ·ç‚¹: [7000, 0, 0]
- ç»ˆç‚¹: [2000, 0, 1000]
- æ°´å¹³è·ç¦»: 5000 m
- å‚ç›´è·ç¦»: 1000 m
- æ–œè·: sqrt(5000Â² + 1000Â²) = 5099 m

**è°ƒç”¨æ¨¡å‹**:
```python
rate, sinr, _ = uav_oma_rate(
    uav_pos=[2000, 0, 1000],
    user_pos=[7000, 0, 0],
    P_uav_W=3.16,
    B_Hz=2e6
)
```

**å¸ˆå¦¹æ¨¡å‹è®¡ç®—è¿‡ç¨‹**:
1. ä»°è§’: Î¸ = arctan(1000/5000) = 11.3Â°
2. LOSæ¦‚ç‡: P_LOS â‰ˆ 0.8ï¼ˆä¸­ç­‰ä»°è§’ï¼‰
3. LOSè·¯æŸ: L_LOS â‰ˆ 110 dB
4. NLOSè·¯æŸ: L_NLOS â‰ˆ 125 dB
5. ç»¼åˆè·¯æŸ: L = 0.8Ã—110 + 0.2Ã—125 = 113 dB
6. SINR â‰ˆ 26.09 dB
7. é€Ÿç‡: 17.34 Mbps

**è¾“å‡º**:
```
é€Ÿç‡: 17.34 Mbps
å»¶è¿Ÿ: 0.017 ms
SINR: 26.09 dB
```

#### ç«¯åˆ°ç«¯æ±‡æ€»
```python
links = [
    {"rate": 31.81, "delay": 2.71, "sinr": 3.04},    # s2_r1â†’sat
    {"rate": 161.33, "delay": 2.71, "sinr": 24.27},  # s1_r2â†’sat
    {"rate": 3.60, "delay": 0.0033, "sinr": 3.95},   # tâ†’s2_r1 âš ï¸ç“¶é¢ˆ
    {"rate": 17.34, "delay": 0.017, "sinr": 26.09}   # tâ†’s1_r2
]

bottleneck_rate = min(31.81, 161.33, 3.60, 17.34) = 3.60 Mbps âš ï¸
total_delay = 2.71 + 2.71 + 0.0033 + 0.017 = 5.44 ms
worst_sinr = min(3.04, 24.27, 3.95, 26.09) = 3.04 dB
packet_loss = 2.00%
```

**æœ€ç»ˆç»“æœ**:
```json
{
  "topo02": {
    "end_to_end": {
      "rate_mbps": 3.60,
      "delay_ms": 5.44,
      "sinr_db": 3.04,
      "packet_loss_percent": 2.0
    }
  }
}
```

---

### ğŸ”¹ Topo03: Z3 Up - Tç”¨æˆ·åä½œNOMA

#### èŠ‚ç‚¹åæ ‡
```python
sat = [0, 0, 813000]
s_r_uav = [5000, 0, 1000]
t2_ground = [9000, 0, 0]
t1_ground = [3500, 0, 0]
```

#### é“¾è·¯1: s_r_uav â†’ sat (å«æ˜Ÿé“¾è·¯)
**è¾“å…¥**:
- UAVä½ç½®: [5000, 0, 1000]
- å«æ˜Ÿä½ç½®: [0, 0, 813000]
- è·ç¦»: sqrt(5000Â² + 812000Â²) = 812,015 m

**è¾“å‡º**ï¼ˆå¸ˆå¦¹æ¨¡å‹ï¼‰:
```
é€Ÿç‡: 158.52 Mbps
å»¶è¿Ÿ: 2.71 ms
SINR: 23.84 dB
```

#### é“¾è·¯2: t2_ground â†’ s_r_uav (UAVé“¾è·¯)
**è¾“å…¥**:
- T2ä½ç½®: [9000, 0, 0]
- UAVä½ç½®: [5000, 0, 1000]
- æ°´å¹³è·ç¦»: 4000 m
- æ–œè·: sqrt(4000Â² + 1000Â²) = 4123 m

**è¾“å‡º**ï¼ˆå¸ˆå¦¹æ¨¡å‹ï¼‰:
```
é€Ÿç‡: 20.53 Mbps  âš ï¸ç“¶é¢ˆ
å»¶è¿Ÿ: 0.014 ms
SINR: 25.60 dB
```

#### é“¾è·¯3: t1_ground â†’ s_r_uav (UAVé“¾è·¯)
**è¾“å…¥**:
- T1ä½ç½®: [3500, 0, 0]
- UAVä½ç½®: [5000, 0, 1000]
- æ°´å¹³è·ç¦»: 1500 m
- æ–œè·: sqrt(1500Â² + 1000Â²) = 1803 m

**è¾“å‡º**ï¼ˆå¸ˆå¦¹æ¨¡å‹ï¼‰:
```
é€Ÿç‡: 29.21 Mbps
å»¶è¿Ÿ: 0.006 ms
SINR: 28.47 dB
```

#### ç«¯åˆ°ç«¯æ±‡æ€»
```python
bottleneck_rate = min(158.52, 20.53, 29.21) = 20.53 Mbps
total_delay = 2.71 + 0.014 + 0.006 = 2.73 ms
worst_sinr = min(23.84, 25.60, 28.47) = 23.84 dB
packet_loss = sinr_to_packet_loss(23.84) = 0.10%  # >20dB
```

**æœ€ç»ˆç»“æœ**:
```json
{
  "topo03": {
    "end_to_end": {
      "rate_mbps": 20.53,
      "delay_ms": 2.73,
      "sinr_db": 23.84,
      "packet_loss_percent": 0.1
    }
  }
}
```

---

### ğŸ”¹ Topo09: Z3 Down - Tç”¨æˆ·åä½œä¸‹è¡Œ

#### èŠ‚ç‚¹åæ ‡
```python
sat = [0, 0, 813000]
s_r_uav = [5000, 0, 1000]
t1_ground = [3500, 0, 0]
t2_ground = [4500, 0, 0]  # è·T1ä»…1000m
```

#### é“¾è·¯1-3åŒtopo03
ï¼ˆå«æ˜Ÿâ†’UAV, UAVâ†’T1, UAVâ†’T2ï¼‰

#### é“¾è·¯4: t1_ground â†’ t2_ground (D2Dåä½œé“¾è·¯)
**è¾“å…¥**:
- T1ä½ç½®: [3500, 0, 0]
- T2ä½ç½®: [4500, 0, 0]
- è·ç¦»: 1000 mï¼ˆå·²ä¿®æ­£ï¼ŒåŸ2800mä¼šå¯¼è‡´0.3 Mbpsï¼‰

**è°ƒç”¨æ¨¡å‹**:
```python
rate, sinr, _ = d2d_oma_rate(
    pos1=[3500, 0, 0],
    pos2=[4500, 0, 0],
    P_tx_W=0.2,
    B_Hz=2e6
)
```

**è¾“å‡º**ï¼ˆå¸ˆå¦¹æ¨¡å‹ï¼‰:
```
é€Ÿç‡: 3.60 Mbps  âš ï¸âš ï¸ç“¶é¢ˆ
å»¶è¿Ÿ: 0.0033 ms
SINR: 3.95 dB
```

#### ç«¯åˆ°ç«¯æ±‡æ€»
```python
links = [
    {"rate": 158.52, "sinr": 23.84},
    {"rate": 26.46, "sinr": 39.82},
    {"rate": 29.21, "sinr": 43.97},
    {"rate": 3.60, "sinr": 3.95}  # âš ï¸D2Dåä½œé“¾è·¯æˆä¸ºä¸¥é‡ç“¶é¢ˆ
]

bottleneck_rate = 3.60 Mbps  # ä»topo03çš„20.53æš´è·Œåˆ°3.60
worst_sinr = 3.95 dB
packet_loss = 2.00%
```

**æœ€ç»ˆç»“æœ**:
```json
{
  "topo09": {
    "end_to_end": {
      "rate_mbps": 3.60,
      "delay_ms": 2.72,
      "sinr_db": 3.95,
      "packet_loss_percent": 2.0
    }
  }
}
```

---

### ğŸ”¹ Topo11: Z5 Down - æ··åˆç›´è¿+å¤šè·³åä½œ

#### èŠ‚ç‚¹åæ ‡
```python
sat = [0, 0, 813000]
s1_uav = [2000, 0, 1000]
s2_r_ground = [8000, 0, 0]
t1_ground = [7500, 0, 0]
t2_ground = [9000, 0, 0]  # è·T1 1500m
```

#### å…³é”®ç“¶é¢ˆé“¾è·¯: t1_ground â†’ t2_ground
**è¾“å…¥**:
- è·ç¦»: 1500 mï¼ˆæ¯”topo09æ›´è¿œï¼‰

**è°ƒç”¨æ¨¡å‹**:
```python
rate, sinr, _ = d2d_oma_rate(
    pos1=[7500, 0, 0],
    pos2=[9000, 0, 0],
    P_tx_W=0.2,
    B_Hz=2e6
)
```

**è¾“å‡º**ï¼ˆå¸ˆå¦¹æ¨¡å‹ï¼‰:
```
é€Ÿç‡: 1.59 Mbps  âš ï¸âš ï¸âš ï¸æœ€ä¸¥é‡ç“¶é¢ˆ
å»¶è¿Ÿ: 0.005 ms
SINR: -1.33 dB  # è´Ÿå€¼ï¼
```

#### ç«¯åˆ°ç«¯æ±‡æ€»
```python
bottleneck_rate = 1.59 Mbps  # 12æ‹“æ‰‘ä¸­æœ€ä½
worst_sinr = -1.33 dB         # å”¯ä¸€è´ŸSINR
packet_loss = 3.00%           # 12æ‹“æ‰‘ä¸­æœ€é«˜
```

**æœ€ç»ˆç»“æœ**:
```json
{
  "topo11": {
    "end_to_end": {
      "rate_mbps": 1.59,
      "delay_ms": 5.45,
      "sinr_db": -1.33,
      "packet_loss_percent": 3.0
    }
  }
}
```

---

## ğŸ“ˆ å…¶ä½™æ‹“æ‰‘è®¡ç®—è¿‡ç¨‹

### Topo04-06 (ä¸Šè¡Œï¼Œç±»ä¼¼æ¨¡å¼)
- **Topo04**: ç“¶é¢ˆæ˜¯Tâ†’UAV (29.21 Mbps)
- **Topo05**: ç“¶é¢ˆæ˜¯T2â†’UAV (23.03 Mbps)
- **Topo06**: ç“¶é¢ˆæ˜¯T1â†’UAV (29.21 Mbps)

### Topo07-08, 10, 12 (ä¸‹è¡Œï¼Œæœ‰åä½œ)
- **Topo07**: ç“¶é¢ˆæ˜¯UAVâ†’åœ°é¢åä½œ (14.08 Mbps)
- **Topo08**: ç“¶é¢ˆæ˜¯UAVâ†’T (8.77 Mbps)
- **Topo10**: ç“¶é¢ˆæ˜¯S2/Râ†’T (8.77 Mbps)
- **Topo12**: ç“¶é¢ˆæ˜¯UAVâ†’T1 (8.77 Mbps)

---

## ğŸ¯ è®¡ç®—ç»“æœæ±‡æ€»è¡¨

| æ‹“æ‰‘ | é€Ÿç‡(Mbps) | å»¶è¿Ÿ(ms) | SINR(dB) | ä¸¢åŒ…(%) | ç“¶é¢ˆé“¾è·¯ | ç“¶é¢ˆç±»å‹ |
|------|-----------|---------|---------|---------|---------|---------|
| topo01 | 31.81 | 5.42 | 3.04 | 2.0 | åœ°é¢â†’å«æ˜Ÿ | å«æ˜Ÿ |
| topo02 | 3.60 | 5.44 | 3.04 | 2.0 | Tâ†’S2/R1 | **D2D** âš ï¸ |
| topo03 | 20.53 | 2.73 | 23.84 | 0.1 | T2â†’UAV | UAV |
| topo04 | 29.21 | 5.42 | 3.04 | 2.0 | Tâ†’UAV | UAV |
| topo05 | 23.03 | 5.43 | 3.04 | 2.0 | T2â†’UAV | UAV |
| topo06 | 29.21 | 5.42 | 23.35 | 0.1 | T1â†’UAV | UAV |
| topo07 | 14.08 | 5.44 | 3.04 | 2.0 | UAVâ†’åœ°é¢ | UAV |
| topo08 | 8.77 | 5.46 | 3.04 | 2.0 | UAVâ†’T | UAV |
| topo09 | 3.60 | 2.72 | 3.95 | 2.0 | T1â†’T2 | **D2D** âš ï¸âš ï¸ |
| topo10 | 8.77 | 5.44 | 3.04 | 2.0 | S2/Râ†’T | D2D |
| topo11 | 1.59 | 5.45 | -1.33 | 3.0 | T1â†’T2 | **D2D** âš ï¸âš ï¸âš ï¸ |
| topo12 | 8.77 | 5.44 | 3.04 | 2.0 | UAVâ†’T1 | UAV |

---

## ğŸ” å…³é”®å‘ç°

### 1. é€Ÿç‡åˆ†å¸ƒç‰¹å¾
- **é«˜é€Ÿ** (>20 Mbps): topo01, 03, 04, 05, 06 - æ— D2Dç“¶é¢ˆ
- **ä¸­é€Ÿ** (8-20 Mbps): topo07, 08, 10, 12 - UAVç“¶é¢ˆ
- **ä½é€Ÿ** (<5 Mbps): topo02, 09, 11 - **D2Dç“¶é¢ˆ**

### 2. D2Dé“¾è·¯æ˜¯æœ€å¤§ç“¶é¢ˆ
| æ‹“æ‰‘ | D2Dè·ç¦» | åŠŸç‡ | é€Ÿç‡ | SINR |
|------|---------|------|------|------|
| topo02 | 1000m | 0.2W | 3.60 Mbps | 3.95 dB |
| topo09 | 1000m | 0.2W | 3.60 Mbps | 3.95 dB |
| topo11 | 1500m | 0.2W | **1.59 Mbps** | **-1.33 dB** âš ï¸ |

**ç»“è®º**: D2DåŠŸç‡0.2Wå¤ªä½ï¼Œ>1kmè·ç¦»å‡ ä¹æ— æ³•é€šä¿¡

### 3. å»¶è¿Ÿåˆ†ç»„æ˜æ˜¾
- **ä½å»¶è¿Ÿ** (2.7ms): topo03, 09 - æ— å«æ˜Ÿç›´è¿
- **é«˜å»¶è¿Ÿ** (5.4ms): å…¶ä½™10ä¸ª - æœ‰å«æ˜Ÿé“¾è·¯

### 4. ä¸¢åŒ…ç‡ä¸SINRå¼ºç›¸å…³
| SINRèŒƒå›´ | ä¸¢åŒ…ç‡ | æ‹“æ‰‘ç¤ºä¾‹ |
|---------|--------|---------|
| >20 dB | 0.1% | topo03, 06 |
| 0-10 dB | 2.0% | å¤§éƒ¨åˆ†æ‹“æ‰‘ |
| -5-0 dB | 3.0% | topo11 |

---

## ğŸ› ï¸ éªŒè¯æ–¹æ³•

### æ‰‹åŠ¨éªŒè¯topo01é“¾è·¯1
```python
from test_satellite_noma import oma_rate_single_device
import numpy as np

sat_pos = np.array([0, 0, 813000])
dev_pos = np.array([8000, 0, 0])

rate, sinr, details = oma_rate_single_device(
    sat_pos, dev_pos,
    P_tx_W=20.0,
    B_Hz=20e6,
    is_uav=False
)

print(f"é€Ÿç‡: {rate:.2f} Mbps")
print(f"SINR: {10*np.log10(sinr):.2f} dB")
# è¾“å‡º: é€Ÿç‡: 31.81 Mbps, SINR: 3.04 dB âœ“
```

### éªŒè¯ç“¶é¢ˆè®¡ç®—
```python
import json
with open('topology_params.json') as f:
    data = json.load(f)

# topo01
links = data['topo01']['links']
rates = [l['rate_mbps'] for l in links]
print(f"topo01 é“¾è·¯é€Ÿç‡: {rates}")
print(f"ç“¶é¢ˆé€Ÿç‡: {min(rates):.2f} Mbps")
print(f"ç«¯åˆ°ç«¯é€Ÿç‡: {data['topo01']['end_to_end']['rate_mbps']} Mbps")
# éªŒè¯: min(rates) == end_to_end['rate_mbps'] âœ“
```

---

## ğŸ“ æ€»ç»“

### è®¡ç®—ç‰¹ç‚¹
1. âœ… **100%åŸºäºç‰©ç†æ¨¡å‹** - æ— äººå·¥å‡è®¾å€¼
2. âœ… **å¯å¤ç°** - ç›¸åŒåæ ‡å¿…å¾—ç›¸åŒç»“æœ
3. âœ… **ç¬¦åˆç†è®º** - é¦™å†œå…¬å¼ã€ä¼ æ’­æ¨¡å‹
4. âœ… **å‚æ•°çœŸå®** - å¸ˆå¦¹çš„åŠŸç‡/å¸¦å®½é…ç½®åˆç†

### è®¡ç®—ç“¶é¢ˆ
1. âš ï¸ **D2Dé“¾è·¯** - åŠŸç‡0.2Wå¯¼è‡´ä½é€Ÿç‡
2. âš ï¸ **å«æ˜Ÿè¾¹ç¼˜ç”¨æˆ·** - æ³¢æŸå¢ç›Šä½å¯¼è‡´SINRå·®
3. âœ… **UAVé“¾è·¯** - æ€§èƒ½æœ€ç¨³å®š

### ä¼˜åŒ–å»ºè®®
è§ `ä½é€Ÿæ‹“æ‰‘ä¼˜åŒ–æ–¹æ¡ˆ.md`

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**åˆ›å»ºæ—¶é—´**: 2025-11-28
**çŠ¶æ€**: âœ… è¯¦ç»†è®°å½•12æ‹“æ‰‘å‚æ•°è®¡ç®—å…¨è¿‡ç¨‹
**ç›¸å…³æ–‡ä»¶**:
- `topology_node_positions.py` - èŠ‚ç‚¹åæ ‡å®šä¹‰
- `calculate_topology_params.py` - å‚æ•°è®¡ç®—è„šæœ¬
- `topology_params.json` - è®¡ç®—ç»“æœ
- `test_satellite_noma.py` - å¸ˆå¦¹çš„å«æ˜Ÿæ¨¡å‹
- `test_uav_noma.py` - å¸ˆå¦¹çš„UAVæ¨¡å‹
- `test_d2d_noma.py` - å¸ˆå¦¹çš„D2Dæ¨¡å‹
