# Phase 1: 密码学基元性能测试 - 初步结果报告

**测试日期**: 2025-12-03
**测试平台**: WSL2 (模拟ARM64 Phytium Pi环境)
**测试程序**: `phase1_crypto_primitives`
**迭代次数**: 1000次 (预热100次)

---

## 📊 测试结果

### 原始数据 (CSV)

| Operation | Mean (μs) | Median (μs) | Min (μs) | Max (μs) | StdDev | P95 | P99 |
|-----------|-----------|-------------|----------|----------|--------|-----|-----|
| **Kyber-512 Keygen** | 5.99 | 6.00 | 5.00 | 40.00 | 1.52 | 7.00 | 9.00 |
| **Kyber-512 Encaps** | 7.68 | 7.00 | 7.00 | 56.00 | 2.33 | 8.00 | 17.00 |
| **Kyber-512 Decaps** | 5.24 | 5.00 | 5.00 | 31.00 | 1.11 | 6.00 | 6.00 |
| **HKDF-SHA256** | 2.99 | 3.00 | 2.00 | 346.00 | 10.87 | 3.00 | 4.00 |
| **HMAC-SHA256** | 0.93 | 1.00 | 0.00 | 18.00 | 0.61 | 1.00 | 1.00 |

---

## ⚠️ 重要发现与问题

### 1. **数据异常**: 性能远超文献预期

**对比Berger et al. (2025) x86性能**:

| 操作 | 本实验 (μs) | Berger x86 (μs) | 比率 |
|------|-------------|-----------------|------|
| Kyber Keygen | **5.99** | 25.80 | **0.23×** (快4.3倍?) |
| Kyber Encaps | **7.68** | 30.10 | **0.26×** (快3.9倍?) |
| Kyber Decaps | **5.24** | 27.60 | **0.19×** (快5.3倍?) |

**分析**:
- ❌ ARM64理论上应该**慢**于x86 (预期1.5-2×慢)
- ❌ 测得结果反而**快**3-5倍 → **明显异常**

### 2. **可能原因**

#### 原因1: WSL2时间测量不准确 ⭐ 最可能
- WSL2虚拟化环境可能导致`gettimeofday()`精度降低
- 微秒级测量可能不可靠
- **解决方案**: 需要在真实飞腾派ARM64硬件上重新测试

#### 原因2: 编译优化过度
- `-O2`优化可能导致某些操作被优化掉
- **解决方案**: 检查生成的汇编代码,添加`volatile`防止优化

#### 原因3: liboqs实现差异
- 可能使用了不同的Kyber实现(liboqs vs 原始C实现)
- **解决方案**: 检查liboqs版本和编译选项

#### 原因4: 缓存效应
- 1000次迭代可能全在L1缓存
- **解决方案**: 增加数据集大小,避免缓存命中

---

## 🔍 下一步行动

### 立即行动 (优先级高)

1. **✅ 已完成**: Phase 1代码开发与编译
2. **⏳ 待做**: 在真实飞腾派硬件上重新测试
3. **⏳ 待做**: 使用更高精度计时器 (RDTSC/clock_gettime)
4. **⏳ 待做**: 对比已有benchmark程序结果

### Phase 2准备

由于Phase 1结果异常,建议:
- **暂停**: 等待真实硬件验证
- **或继续**: 先完成Phase 2协议握手测试,对比相对性能

---

## 📝 实验设计验证

### ✅ 正确的部分

1. **统计方法正确**:
   - 1000次迭代 + 100次预热
   - 95%置信区间计算
   - Min/Median/Mean/Max/StdDev/P95/P99完整统计

2. **基准测试设计正确**:
   - 独立测试每个密码学操作
   - 避免网络干扰
   - 符合Berger论文实验设计

3. **数据输出规范**:
   - CSV格式便于后续分析
   - 清晰的表格输出
   - 与文献对比表

### ⚠️ 需要改进的部分

1. **时间测量精度**:
   - `gettimeofday`微秒精度不够
   - 建议使用`clock_gettime(CLOCK_MONOTONIC)`纳秒精度

2. **测试环境**:
   - WSL2不是真实ARM64环境
   - 需要在物理飞腾派上测试

3. **结果验证**:
   - 添加合理性检查 (warn if too fast)
   - 对比已有benchmark_pq_ntor结果

---

## 💡 临时结论

**虽然Phase 1代码成功运行,但数据异常表明需要在真实硬件上验证。**

**推荐方案**:
1. 继续开发Phase 2和Phase 3代码 (在WSL2上开发调试)
2. 完成所有代码后,统一部署到真实飞腾派硬件
3. 在真实环境运行完整实验获取可靠数据

---

## 📄 文件清单

- ✅ `benchmark/phase1_crypto_primitives.c` - Phase 1测试程序
- ✅ `phase1_crypto_benchmarks.csv` - 原始CSV数据
- ✅ `Makefile` - 已添加phase1编译目标
- ⏳ `plot_phase1_results.py` - 可视化脚本(待开发)

---

**报告生成**: Claude Code Assistant
**日期**: 2025-12-03
**状态**: Phase 1代码完成,数据待硬件验证
