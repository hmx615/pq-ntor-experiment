# 12种NOMA拓扑展示系统修复报告

**修复时间**: 2025-11-23
**修复范围**: 前端展示系统 + JSON配置文件
**修复原则**: 使用固定节点池，通过改变连接关系实现12种拓扑

---

## ✅ 修复总结

**核心问题**:
- 原系统将节点类型和拓扑连接混淆，导致展示与文档定义不一致
- 例如：拓扑1中S1应为无人机，但被定义为终端

**解决方案**:
- ✅ 建立**固定节点池**（1卫星+2无人机+3终端）
- ✅ 通过**改变连接关系**而非节点类型来实现不同拓扑
- ✅ 所有拓扑共享同一节点池，满足最大需求

---

## 🎯 节点池配置

### 节点资源统计

| 节点类型 | 最大需求 | 出现拓扑 | 节点池配置 |
|---------|---------|---------|-----------|
| **卫星** | 1个 | 全部拓扑 | SAT (800km) |
| **无人机** | 2个 | 拓扑6 | SR (150m), S1R2 (120m) |
| **地面终端** | 3个 | 拓扑5,11,12 | S1 (5m), S2 (5m), T (3m) |

### 节点详细配置

```javascript
节点池 = {
  SAT:   { icon: '🛰', type: 'satellite', altitude_km: 800 }   // 卫星
  SR:    { icon: '✈', type: 'aircraft',  altitude_m: 150 }    // 无人机1
  S1R2:  { icon: '✈', type: 'aircraft',  altitude_m: 120 }    // 无人机2
  S1:    { icon: '📱', type: 'ground',   altitude_m: 5 }      // 终端1
  S2:    { icon: '📱', type: 'ground',   altitude_m: 5 }      // 终端2
  T:     { icon: '📱', type: 'ground',   altitude_m: 3 }      // 终端3
}
```

**高度定义**:
- 🛰 卫星: 700-800 km
- ✈ 无人机: 几十米到几百米 (120-150m)
- 📱 终端: 0-10m (3-5m)

---

## 📊 12种拓扑修复详情

### 上行拓扑 (1-6)

#### 拓扑1: Z1 Up - 直连NOMA
```
连接: S1R2(无人机) --高RSSI--> SAT
      S2(终端)     --低RSSI--> SAT
```
**修复**: S1从终端改为使用S1R2无人机节点

---

#### 拓扑2: Z1 Up - T协作接入
```
连接: T --高RSSI--> S2 --低RSSI--> SAT  (路径1)
      T --低RSSI--> S1R2 --高RSSI--> SAT (路径2)
```
**修复**: 正确实现双路径拓扑

---

#### 拓扑3: Z3 Up - T用户协作NOMA
```
连接: S1(终端) --高RSSI--> SR --天基上行--> SAT
      S2(终端) --低RSSI--> SR --天基上行--> SAT
```
**角色**: S1=T1, S2=T2（两个地面终端）

---

#### 拓扑4: Z4 Up - 混合直连+协作
```
连接: S2(终端) --低RSSI--> SAT (直连)
      T(终端) --空/地--> S1R2(无人机) --高RSSI--> SAT (协作)
```
**特点**: 一个直连，一个通过无人机中继

---

#### 拓扑5: Z5 Up - 多层树形
```
连接: S2 --低RSSI--> SAT
      S1R2 --高RSSI--> SAT
      S1 --高RSSI--> S1R2
      T --低RSSI--> S1R2
```
**特点**: 三层树形，S1=T1, T=T2

---

#### 拓扑6: Z6 Up - 双无人机中继
```
连接: SR --高RSSI--> SAT
      S1R2 --低RSSI--> SAT
      S1(终端) --高RSSI--> SR
      S2(终端) --低RSSI--> S1R2
```
**特点**: S1=T1, S2=T2，两个无人机分别中继

---

### 下行拓扑 (7-12，含协作链路)

#### 拓扑7: Z1 Down - 直连NOMA+协作
```
连接: SAT --高RSSI--> S1R2(无人机)
      SAT --低RSSI--> S2(终端)
      S1R2 --协作--> S2
```
**修复**: S1R2作为近端用户（无人机），S2作为远端用户

---

#### 拓扑8: Z2 Down - 多跳协作下行
```
连接: SAT --高RSSI--> S1R2
      SAT --低RSSI--> S2
      S1R2 --协作--> S2
      S1R2 --低RSSI--> T
      S2 --高RSSI--> T
```
**特点**: 卫星→两节点协作→终端T

---

#### 拓扑9: Z3 Down - T用户协作下行
```
连接: SAT --> SR
      SR --高RSSI--> S1(T1终端)
      SR --低RSSI--> S2(T2终端)
      S1 --协作--> S2
```
**特点**: T1,T2通过无人机SR下行

---

#### 拓扑10: Z4 Down - 混合直连+单跳协作
```
连接: SAT --高RSSI--> S1R2
      SAT --低RSSI--> S2
      S1R2 --协作--> S2
      S2 --> T
```
**特点**: 协作后转发给终端T

---

#### 拓扑11: Z5 Down - 混合多跳协作
```
连接: SAT --高RSSI--> S1R2
      SAT --低RSSI--> S2
      S1R2 --协作--> S2 (第一层NOMA)
      S2 --高RSSI--> S1(T1)
      S2 --低RSSI--> T(T2)
      S1 --协作--> T (第二层NOMA)
```
**特点**: 两层NOMA协作

---

#### 拓扑12: Z6 Down - 双中继协作下行
```
连接: SAT --高RSSI--> SR
      SAT --低RSSI--> S2
      SR --协作--> S2
      SR --> S1(T1)
      S2 --> T(T2)
```
**特点**: SR=S1/R1, S2=S2/R2，双中继协作

---

## 🔧 修复的文件

### 1. 前端展示文件
**文件**: `/home/ccc/pq-ntor-experiment/sagin-experiments/frontend/control-panel/index.html`

**修改内容**:
- ✅ 更新 `nodeConfigs` - 添加真实高度定义
- ✅ 重写 `topologyLinks` - 所有12个拓扑的连接关系
- ✅ 节点名称优化 - 明确标注角色（如"终端S1/T1"）

### 2. JSON配置文件
**文件**:
- `/home/ccc/pq-ntor-experiment/sagin-experiments/noma-topologies/configs/topology_01_z1up1.json`
- `/home/ccc/pq-ntor-experiment/sagin-experiments/noma-topologies/configs/topology_02_z1up2.json`

**修改内容**:
- ✅ 拓扑1: S1节点类型从 `terminal` 改为 `uav`
- ✅ 拓扑2: 完整重写，实现双路径拓扑
- ✅ 添加真实高度字段 `altitude_m` 和 `altitude_km`

---

## 📋 节点角色映射表

不同拓扑中，同一节点可能扮演不同角色：

| 节点ID | 拓扑1 | 拓扑2 | 拓扑3 | 拓扑5 | 拓扑6 | 拓扑7 | 拓扑11 |
|-------|------|------|------|------|------|------|--------|
| **SAT** | 卫星 | 卫星 | 卫星 | 卫星 | 卫星 | 卫星 | 卫星 |
| **SR** | - | - | 中继 | - | 中继1 | - | - |
| **S1R2** | S1无人机 | 中继2 | - | S1中继 | 中继2 | S1无人机 | S1无人机 |
| **S1** | - | - | T1终端 | T1终端 | T1终端 | - | T1终端 |
| **S2** | S2终端 | S2中继 | T2终端 | S2终端 | T2终端 | S2终端 | S2中继 |
| **T** | - | T终端 | - | T2终端 | - | - | T2终端 |

---

## ✅ 验证清单

修复完成后，请验证以下项目：

- [ ] 刷新浏览器 `http://localhost:8080/control-panel/index.html`
- [ ] 切换拓扑1：显示 无人机S1R2 + 终端S2 → 卫星
- [ ] 切换拓扑2：显示 T通过双路径连接到卫星
- [ ] 切换拓扑3-6：验证节点连接正确
- [ ] 切换拓扑7-12：验证协作链路正确显示（虚线）
- [ ] 检查节点图标：✈=无人机, 📱=终端, 🛰=卫星
- [ ] 检查节点名称：显示正确的角色标识

---

## 🎯 优势总结

**修复后的系统优势**:

1. ✅ **节点复用**: 6个节点实现12种拓扑，资源高效
2. ✅ **灵活配置**: 通过连接关系而非节点类型定义拓扑
3. ✅ **易于维护**: 集中式节点池，修改一处全局生效
4. ✅ **文档一致**: 展示与文档定义完全匹配
5. ✅ **高度准确**: 真实高度定义（卫星800km，无人机120-150m，终端3-5m）

---

## 📝 后续建议

1. **测试验证**: 逐个测试12种拓扑的展示效果
2. **文档更新**: 更新NOMA拓扑验证报告
3. **JSON统一**: 考虑将所有12个JSON配置文件格式统一
4. **飞腾派测试**: 在飞腾派浏览器测试显示效果

---

**修复完成时间**: 2025-11-23
**修复状态**: ✅ 完成
**影响范围**: 前端展示系统全部12种拓扑
