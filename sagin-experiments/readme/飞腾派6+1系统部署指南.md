# é£è…¾æ´¾ 6+1 ç³»ç»Ÿéƒ¨ç½²æŒ‡å—

**é€‚ç”¨å¹³å°**: é£è…¾æ´¾ (ARM64)
**ç³»ç»Ÿ**: SAGIN NOMA 6+1 åˆ†å¸ƒå¼å±•ç¤ºç³»ç»Ÿ
**éƒ¨ç½²æ–¹å¼**: ä¸»èŠ‚ç‚¹é…ç½® + ç³»ç»Ÿé•œåƒå¤åˆ¶
**æ›´æ–°æ—¶é—´**: 2025-11-20

---

## ç›®å½•

1. [éƒ¨ç½²æ–¹æ¡ˆæ¦‚è¿°](#ä¸€éƒ¨ç½²æ–¹æ¡ˆæ¦‚è¿°)
2. [ç¡¬ä»¶å‡†å¤‡](#äºŒç¡¬ä»¶å‡†å¤‡)
3. [ä¸»èŠ‚ç‚¹é…ç½®](#ä¸‰ä¸»èŠ‚ç‚¹é…ç½®)
4. [ç³»ç»Ÿé•œåƒåˆ¶ä½œä¸å¤åˆ¶](#å››ç³»ç»Ÿé•œåƒåˆ¶ä½œä¸å¤åˆ¶)
5. [ä»èŠ‚ç‚¹é…ç½®](#äº”ä»èŠ‚ç‚¹é…ç½®)
6. [ç½‘ç»œé…ç½®](#å…­ç½‘ç»œé…ç½®)
7. [ç³»ç»Ÿå¯åŠ¨ä¸æµ‹è¯•](#ä¸ƒç³»ç»Ÿå¯åŠ¨ä¸æµ‹è¯•)
8. [å¸¸è§é—®é¢˜](#å…«å¸¸è§é—®é¢˜)
9. [é™„å½•](#ä¹é™„å½•)

---

## ä¸€ã€éƒ¨ç½²æ–¹æ¡ˆæ¦‚è¿°

### 1.1 ç³»ç»Ÿæ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    6+1 åˆ†å¸ƒå¼ç³»ç»Ÿ                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  é£è…¾æ´¾ 1 (192.168.100.17) - æ§åˆ¶å° + Hub                 â”‚
â”‚    â”œâ”€ WebSocket Hub (9000)                              â”‚
â”‚    â”œâ”€ HTTP Server (8080)                                â”‚
â”‚    â””â”€ Node Agent: SAT (å«æ˜Ÿ)                             â”‚
â”‚                                                          â”‚
â”‚  é£è…¾æ´¾ 2 (192.168.100.18) - èŠ‚ç‚¹è§†å›¾                      â”‚
â”‚    â””â”€ Node Agent: SR (æ— äººæœº1)                           â”‚
â”‚                                                          â”‚
â”‚  é£è…¾æ´¾ 3 (192.168.100.19) - èŠ‚ç‚¹è§†å›¾                      â”‚
â”‚    â””â”€ Node Agent: S1R2 (æ— äººæœº2)                         â”‚
â”‚                                                          â”‚
â”‚  é£è…¾æ´¾ 4 (192.168.100.20) - èŠ‚ç‚¹è§†å›¾                      â”‚
â”‚    â””â”€ Node Agent: S1 (ç»ˆç«¯1)                             â”‚
â”‚                                                          â”‚
â”‚  é£è…¾æ´¾ 5 (192.168.100.21) - èŠ‚ç‚¹è§†å›¾                      â”‚
â”‚    â””â”€ Node Agent: S2 (ç»ˆç«¯2)                             â”‚
â”‚                                                          â”‚
â”‚  é£è…¾æ´¾ 6 (192.168.100.22) - èŠ‚ç‚¹è§†å›¾                      â”‚
â”‚    â””â”€ Node Agent: T (ç»ˆç«¯3)                              â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 éƒ¨ç½²ç­–ç•¥

**âœ… æ¨èæ–¹æ¡ˆ**: ç³»ç»Ÿé•œåƒå¤åˆ¶

**ä¼˜ç‚¹**:
- é…ç½®ä¸€æ¬¡ï¼Œæ‰¹é‡éƒ¨ç½²
- ç¯å¢ƒä¸€è‡´æ€§é«˜ï¼Œå‡å°‘å…¼å®¹æ€§é—®é¢˜
- èŠ‚çœæ—¶é—´ï¼Œ6 å°è®¾å¤‡åªéœ€é…ç½® 1 æ¬¡
- ä¾¿äºåç»­ç»´æŠ¤å’Œæ›´æ–°

**æµç¨‹**:
1. åœ¨**ä¸»èŠ‚ç‚¹**ï¼ˆé£è…¾æ´¾ 1ï¼‰ä¸Šå®Œæˆæ‰€æœ‰è½¯ä»¶å®‰è£…å’Œé…ç½®
2. åˆ¶ä½œç³»ç»Ÿé•œåƒï¼ˆSD å¡ æˆ– eMMCï¼‰
3. å°†é•œåƒå¤åˆ¶åˆ°å…¶ä»– 5 ä¸ªé£è…¾æ´¾
4. åœ¨æ¯ä¸ªä»èŠ‚ç‚¹ä¸Šåªä¿®æ”¹**èŠ‚ç‚¹ ID** å’Œ **IP åœ°å€**

---

## äºŒã€ç¡¬ä»¶å‡†å¤‡

### 2.1 è®¾å¤‡æ¸…å•

| æ•°é‡ | è®¾å¤‡åç§° | ç”¨é€” | IP åœ°å€ |
|-----|---------|------|---------|
| 1 | é£è…¾æ´¾ (ä¸»èŠ‚ç‚¹) | æ§åˆ¶å° + Hub + å«æ˜ŸèŠ‚ç‚¹ | 192.168.100.17 |
| 5 | é£è…¾æ´¾ (ä»èŠ‚ç‚¹) | èŠ‚ç‚¹è§†å›¾ | 192.168.100.18-22 |
| 1 | è·¯ç”±å™¨/äº¤æ¢æœº | ç½‘ç»œäº’è” | - |
| 6 | 14å¯¸æ˜¾ç¤ºå™¨ | æ˜¾ç¤ºè¾“å‡º | - |
| 6 | SD å¡ (32GB+) æˆ– eMMC | ç³»ç»Ÿå­˜å‚¨ | - |
| 6 | ç”µæºé€‚é…å™¨ | ä¾›ç”µ | - |

### 2.2 ç½‘ç»œæ‹“æ‰‘

```
                    è·¯ç”±å™¨/äº¤æ¢æœº
                   192.168.100.1
                         â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚        â”‚       â”‚       â”‚        â”‚        â”‚
      æ´¾1      æ´¾2     æ´¾3     æ´¾4      æ´¾5      æ´¾6
    .17      .18     .19     .20      .21      .22
   æ§åˆ¶å°    SRèŠ‚ç‚¹  S1R2èŠ‚ç‚¹ S1èŠ‚ç‚¹   S2èŠ‚ç‚¹   TèŠ‚ç‚¹
```

---

## ä¸‰ã€ä¸»èŠ‚ç‚¹é…ç½®

**æ“ä½œè®¾å¤‡**: é£è…¾æ´¾ 1 (192.168.100.17)

### 3.1 ç³»ç»Ÿè¦æ±‚æ£€æŸ¥

è¿è¡Œç¯å¢ƒæ£€æµ‹è„šæœ¬ï¼š

```bash
cd /path/to/distributed-demo/scripts
./check_environment.sh
```

**é¢„æœŸè¾“å‡º**:
```
========================================
é£è…¾æ´¾ç¯å¢ƒæ£€æµ‹ - SAGIN 6+1 ç³»ç»Ÿ
========================================

[âœ“] CPU æ¶æ„: aarch64 (ARM64ï¼Œé£è…¾æ´¾å…¼å®¹)
[âœ“] Python3: 3.9.x (>= 3.7)
[âœ“] pip3: 21.x
[âœ“] websockets: å·²å®‰è£…
...
æ‰€æœ‰æ£€æŸ¥é€šè¿‡ï¼ç¯å¢ƒæ»¡è¶³éƒ¨ç½²è¦æ±‚
```

### 3.2 å®‰è£…ä¾èµ–ï¼ˆå¦‚æœæ£€æŸ¥å¤±è´¥ï¼‰

```bash
# æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨
sudo apt update

# å®‰è£… Python ç¯å¢ƒ
sudo apt install -y python3 python3-pip

# å®‰è£… Python ä¾èµ–åŒ…
pip3 install websockets

# å®‰è£…ç³»ç»Ÿå·¥å…· (å¯é€‰)
sudo apt install -y net-tools lsof htop
```

### 3.3 é…ç½®é¡¹ç›®æ–‡ä»¶

#### 1) ä¸‹è½½/å¤åˆ¶é¡¹ç›®åˆ°é£è…¾æ´¾

```bash
# å‡è®¾é¡¹ç›®å·²åœ¨å¼€å‘æœºä¸Šï¼Œé€šè¿‡ scp ä¼ è¾“åˆ°é£è…¾æ´¾
scp -r distributed-demo/ user@192.168.100.17:/home/user/
```

æˆ–è€…ç›´æ¥åœ¨é£è…¾æ´¾ä¸Š git cloneï¼ˆå¦‚æœæœ‰ä»“åº“ï¼‰ï¼š

```bash
git clone <your-repo-url> /home/user/distributed-demo
```

#### 2) é…ç½®èŠ‚ç‚¹ ID

ä¸»èŠ‚ç‚¹è¿è¡Œ**å«æ˜ŸèŠ‚ç‚¹ (SAT)** + **Hub** + **HTTP Server**

åˆ›å»ºèŠ‚ç‚¹å¯åŠ¨è„šæœ¬ï¼š

```bash
cd /home/user/distributed-demo/scripts
```

ç¼–è¾‘æˆ–åˆ›å»º `run_node.sh`:

```bash
#!/bin/bash
# é£è…¾æ´¾èŠ‚ç‚¹å¯åŠ¨è„šæœ¬

# èŠ‚ç‚¹ ID é…ç½® (æ¯ä¸ªé£è…¾æ´¾ä¸åŒ)
export NODE_ID="SAT"              # èŠ‚ç‚¹ ID: SAT/SR/S1R2/S1/S2/T
export NODE_ROLE="satellite"       # èŠ‚ç‚¹è§’è‰²: satellite/aircraft/ground
export HUB_URL="ws://192.168.100.17:9000"  # WebSocket Hub åœ°å€

# é¡¹ç›®è·¯å¾„
PROJECT_ROOT="/home/user/distributed-demo"

# å¯åŠ¨ Node Agent
cd "$PROJECT_ROOT/backend"
python3 node_agent.py
```

èµ‹äºˆæ‰§è¡Œæƒé™ï¼š

```bash
chmod +x run_node.sh
```

#### 3) é…ç½® systemd æœåŠ¡ï¼ˆå¼€æœºè‡ªå¯ï¼‰

åˆ›å»º WebSocket Hub æœåŠ¡ï¼š

```bash
sudo nano /etc/systemd/system/sagin-hub.service
```

å†™å…¥ä»¥ä¸‹å†…å®¹ï¼š

```ini
[Unit]
Description=SAGIN WebSocket Hub
After=network.target

[Service]
Type=simple
User=user
WorkingDirectory=/home/user/distributed-demo/backend
ExecStart=/usr/bin/python3 /home/user/distributed-demo/backend/websocket_hub.py
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

åˆ›å»º Node Agent æœåŠ¡ï¼š

```bash
sudo nano /etc/systemd/system/sagin-node.service
```

å†™å…¥ä»¥ä¸‹å†…å®¹ï¼š

```ini
[Unit]
Description=SAGIN Node Agent
After=network.target sagin-hub.service
Requires=sagin-hub.service

[Service]
Type=simple
User=user
WorkingDirectory=/home/user/distributed-demo/scripts
Environment="NODE_ID=SAT"
Environment="NODE_ROLE=satellite"
Environment="HUB_URL=ws://192.168.100.17:9000"
ExecStart=/usr/bin/python3 /home/user/distributed-demo/backend/node_agent.py
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

åˆ›å»º HTTP Server æœåŠ¡ï¼š

```bash
sudo nano /etc/systemd/system/sagin-http.service
```

å†™å…¥ä»¥ä¸‹å†…å®¹ï¼š

```ini
[Unit]
Description=SAGIN HTTP Server
After=network.target

[Service]
Type=simple
User=user
WorkingDirectory=/home/user/distributed-demo/frontend
ExecStart=/usr/bin/python3 -m http.server 8080
Restart=always
RestartSec=10

[Install]
WantedBy=multi-user.target
```

å¯ç”¨æœåŠ¡ï¼ˆä½†æš‚ä¸å¯åŠ¨ï¼Œç­‰é•œåƒå¤åˆ¶åç»Ÿä¸€å¯åŠ¨ï¼‰ï¼š

```bash
sudo systemctl daemon-reload
sudo systemctl enable sagin-hub.service
sudo systemctl enable sagin-node.service
sudo systemctl enable sagin-http.service
```

### 3.4 ç½‘ç»œé…ç½®

è®¾ç½®é™æ€ IPï¼š

```bash
sudo nano /etc/network/interfaces
```

æˆ–è€…ä½¿ç”¨ NetworkManagerï¼š

```bash
sudo nmcli con mod "æœ‰çº¿è¿æ¥ 1" ipv4.addresses 192.168.100.17/24
sudo nmcli con mod "æœ‰çº¿è¿æ¥ 1" ipv4.gateway 192.168.100.1
sudo nmcli con mod "æœ‰çº¿è¿æ¥ 1" ipv4.dns "8.8.8.8"
sudo nmcli con mod "æœ‰çº¿è¿æ¥ 1" ipv4.method manual
sudo nmcli con up "æœ‰çº¿è¿æ¥ 1"
```

### 3.5 æµ‹è¯•è¿è¡Œ

æ‰‹åŠ¨æµ‹è¯•ä¸€æ¬¡ï¼ˆä¸é€šè¿‡ systemdï¼‰ï¼š

```bash
cd /home/user/distributed-demo/scripts
./test_local.sh start
```

**æ£€æŸ¥**:
- æµè§ˆå™¨è®¿é—®: `http://192.168.100.17:8080/control-panel/`
- åº”è¯¥èƒ½çœ‹åˆ°æ§åˆ¶å°ç•Œé¢
- æ˜¾ç¤º 1/6 èŠ‚ç‚¹åœ¨çº¿ï¼ˆå½“å‰åªæœ‰ä¸»èŠ‚ç‚¹ï¼‰

æµ‹è¯•å®Œæˆååœæ­¢ï¼š

```bash
./test_local.sh stop
```

---

## å››ã€ç³»ç»Ÿé•œåƒåˆ¶ä½œä¸å¤åˆ¶

**âš ï¸ é‡è¦**: åˆ¶ä½œé•œåƒå‰ï¼Œç¡®ä¿ä¸»èŠ‚ç‚¹å·²å®Œå…¨é…ç½®å¹¶æµ‹è¯•é€šè¿‡

### 4.1 é•œåƒåˆ¶ä½œæ–¹å¼

#### æ–¹æ¡ˆ A: SD å¡é•œåƒï¼ˆæ¨èï¼‰

**ä¼˜ç‚¹**: æ“ä½œç®€å•ï¼Œå·¥å…·æˆç†Ÿ

**æ­¥éª¤**:

1. **å…³é—­ä¸»èŠ‚ç‚¹é£è…¾æ´¾**ï¼š

```bash
sudo shutdown -h now
```

2. **å–å‡º SD å¡ï¼Œæ’å…¥è¯»å¡å™¨è¿æ¥åˆ°ç”µè„‘ï¼ˆLinux/Windows/Macï¼‰**

3. **åœ¨ Linux ä¸Šåˆ¶ä½œé•œåƒ**ï¼š

```bash
# æŸ¥æ‰¾ SD å¡è®¾å¤‡åï¼ˆé€šå¸¸æ˜¯ /dev/sdX æˆ– /dev/mmcblkXï¼‰
lsblk

# åˆ¶ä½œé•œåƒï¼ˆå‡è®¾ SD å¡æ˜¯ /dev/sdcï¼Œ32GBï¼‰
sudo dd if=/dev/sdc of=sagin-master-node.img bs=4M status=progress

# å‹ç¼©é•œåƒä»¥èŠ‚çœç©ºé—´å’Œä¼ è¾“æ—¶é—´
gzip sagin-master-node.img
# ç”Ÿæˆ: sagin-master-node.img.gz
```

4. **åœ¨ Windows ä¸Šåˆ¶ä½œé•œåƒ**ï¼š

- ä½¿ç”¨ **Win32DiskImager** æˆ– **Rufus**
- é€‰æ‹©"è¯»å–"åŠŸèƒ½ï¼Œä¿å­˜ä¸º `.img` æ–‡ä»¶

#### æ–¹æ¡ˆ B: eMMC å…‹éš†ï¼ˆé€‚ç”¨äºä½¿ç”¨ eMMC çš„é£è…¾æ´¾ï¼‰

å¦‚æœé£è…¾æ´¾ä½¿ç”¨æ¿è½½ eMMCï¼š

```bash
# åœ¨é£è…¾æ´¾ä¸Šç›´æ¥åˆ¶ä½œé•œåƒåˆ° U ç›˜/ç½‘ç»œå­˜å‚¨
sudo dd if=/dev/mmcblk0 of=/mnt/usb/sagin-master-node.img bs=4M status=progress
```

### 4.2 é•œåƒå¤åˆ¶åˆ°ä»èŠ‚ç‚¹

#### æ–¹æ³• 1: SD å¡çƒ§å½•ï¼ˆæ¨èï¼‰

å¯¹äºæ¯ä¸ªä»èŠ‚ç‚¹ï¼ˆé£è…¾æ´¾ 2-6ï¼‰ï¼š

1. å‡†å¤‡æ–°çš„ SD å¡
2. ä½¿ç”¨é•œåƒçƒ§å½•å·¥å…·ï¼š

**Linux**:
```bash
# è§£å‹é•œåƒ
gunzip sagin-master-node.img.gz

# çƒ§å½•åˆ° SD å¡ï¼ˆå‡è®¾æ–° SD å¡æ˜¯ /dev/sddï¼‰
sudo dd if=sagin-master-node.img of=/dev/sdd bs=4M status=progress
sync
```

**Windows**:
- ä½¿ç”¨ **balenaEtcher** æˆ– **Rufus**
- é€‰æ‹©é•œåƒæ–‡ä»¶å’Œç›®æ ‡ SD å¡
- ç‚¹å‡»"çƒ§å½•"

3. å°† SD å¡æ’å…¥å¯¹åº”çš„é£è…¾æ´¾

#### æ–¹æ³• 2: ç½‘ç»œå…‹éš†ï¼ˆé«˜çº§ï¼‰

é€šè¿‡ç½‘ç»œç›´æ¥ä¼ è¾“é•œåƒï¼š

```bash
# åœ¨ç›®æ ‡é£è…¾æ´¾ä¸Šï¼ˆä» PXE æˆ– Live USB å¯åŠ¨ï¼‰
ssh user@192.168.100.17 "sudo dd if=/dev/mmcblk0 bs=4M" | sudo dd of=/dev/mmcblk0 bs=4M
```

---

## äº”ã€ä»èŠ‚ç‚¹é…ç½®

**âš ï¸ å…³é”®æ­¥éª¤**: æ¯ä¸ªä»èŠ‚ç‚¹éœ€è¦ä¿®æ”¹èŠ‚ç‚¹ ID å’Œ IP åœ°å€

### 5.1 èŠ‚ç‚¹æ˜ å°„è¡¨

| é£è…¾æ´¾ | IP åœ°å€ | èŠ‚ç‚¹ ID | èŠ‚ç‚¹è§’è‰² | æœåŠ¡ |
|--------|---------|---------|---------|------|
| æ´¾ 1 | 192.168.100.17 | SAT | satellite | Hub + HTTP + Agent |
| æ´¾ 2 | 192.168.100.18 | SR | aircraft | Agent |
| æ´¾ 3 | 192.168.100.19 | S1R2 | aircraft | Agent |
| æ´¾ 4 | 192.168.100.20 | S1 | ground | Agent |
| æ´¾ 5 | 192.168.100.21 | S2 | ground | Agent |
| æ´¾ 6 | 192.168.100.22 | T | ground | Agent |

### 5.2 é…ç½®æ­¥éª¤ï¼ˆå¯¹æ¯ä¸ªä»èŠ‚ç‚¹ï¼‰

#### 1) å¯åŠ¨é£è…¾æ´¾å¹¶ç™»å½•

å°†çƒ§å½•å¥½çš„ SD å¡æ’å…¥é£è…¾æ´¾ï¼Œè¿æ¥æ˜¾ç¤ºå™¨å’Œé”®ç›˜ï¼Œå¯åŠ¨ã€‚

#### 2) ä¿®æ”¹ä¸»æœºåï¼ˆå¯é€‰ä½†æ¨èï¼‰

```bash
# é£è…¾æ´¾ 2 ç¤ºä¾‹
sudo hostnamectl set-hostname sagin-node-sr

# ä¿®æ”¹ hosts æ–‡ä»¶
sudo nano /etc/hosts
# å°† 127.0.1.1 åé¢çš„ä¸»æœºåæ”¹ä¸º sagin-node-sr
```

#### 3) ä¿®æ”¹ IP åœ°å€

```bash
# é£è…¾æ´¾ 2 (SR èŠ‚ç‚¹) ç¤ºä¾‹
sudo nmcli con mod "æœ‰çº¿è¿æ¥ 1" ipv4.addresses 192.168.100.18/24
sudo nmcli con mod "æœ‰çº¿è¿æ¥ 1" ipv4.gateway 192.168.100.1
sudo nmcli con mod "æœ‰çº¿è¿æ¥ 1" ipv4.dns "8.8.8.8"
sudo nmcli con mod "æœ‰çº¿è¿æ¥ 1" ipv4.method manual
sudo nmcli con up "æœ‰çº¿è¿æ¥ 1"
```

æˆ–è€…ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼š

```bash
sudo nano /etc/network/interfaces
```

ç¤ºä¾‹å†…å®¹ï¼š

```
auto eth0
iface eth0 inet static
    address 192.168.100.18
    netmask 255.255.255.0
    gateway 192.168.100.1
    dns-nameservers 8.8.8.8
```

é‡å¯ç½‘ç»œï¼š

```bash
sudo systemctl restart networking
```

#### 4) ä¿®æ”¹èŠ‚ç‚¹ ID

ç¼–è¾‘ systemd æœåŠ¡é…ç½®ï¼š

```bash
sudo nano /etc/systemd/system/sagin-node.service
```

ä¿®æ”¹ä»¥ä¸‹è¡Œï¼ˆé£è…¾æ´¾ 2 ç¤ºä¾‹ï¼‰ï¼š

```ini
Environment="NODE_ID=SR"
Environment="NODE_ROLE=aircraft"
```

**å…¶ä»–èŠ‚ç‚¹å¯¹åº”ä¿®æ”¹**:
- é£è…¾æ´¾ 3: `NODE_ID=S1R2`, `NODE_ROLE=aircraft`
- é£è…¾æ´¾ 4: `NODE_ID=S1`, `NODE_ROLE=ground`
- é£è…¾æ´¾ 5: `NODE_ID=S2`, `NODE_ROLE=ground`
- é£è…¾æ´¾ 6: `NODE_ID=T`, `NODE_ROLE=ground`

#### 5) ç¦ç”¨ä¸éœ€è¦çš„æœåŠ¡

**ä»èŠ‚ç‚¹ä¸éœ€è¦è¿è¡Œ Hub å’Œ HTTP Server**ï¼Œåªéœ€è¦ Node Agentï¼š

```bash
sudo systemctl disable sagin-hub.service
sudo systemctl disable sagin-http.service
sudo systemctl enable sagin-node.service
```

#### 6) é‡æ–°åŠ è½½æœåŠ¡å¹¶å¯åŠ¨

```bash
sudo systemctl daemon-reload
sudo systemctl start sagin-node.service
```

#### 7) æ£€æŸ¥çŠ¶æ€

```bash
sudo systemctl status sagin-node.service
```

åº”è¯¥çœ‹åˆ°ï¼š

```
â— sagin-node.service - SAGIN Node Agent
   Active: active (running) since ...
```

æŸ¥çœ‹æ—¥å¿—ï¼š

```bash
sudo journalctl -u sagin-node.service -f
```

---

## å…­ã€ç½‘ç»œé…ç½®

### 6.1 ç½‘ç»œé…ç½®æ¸…å•

| è®¾å¤‡ | ä¸»æœºå | IP åœ°å€ | è§’è‰² |
|------|--------|---------|------|
| æ´¾ 1 | sagin-hub | 192.168.100.17 | Hub ä¸­å¿ƒ |
| æ´¾ 2 | sagin-node-sr | 192.168.100.18 | SR èŠ‚ç‚¹ |
| æ´¾ 3 | sagin-node-s1r2 | 192.168.100.19 | S1R2 èŠ‚ç‚¹ |
| æ´¾ 4 | sagin-node-s1 | 192.168.100.20 | S1 èŠ‚ç‚¹ |
| æ´¾ 5 | sagin-node-s2 | 192.168.100.21 | S2 èŠ‚ç‚¹ |
| æ´¾ 6 | sagin-node-t | 192.168.100.22 | T èŠ‚ç‚¹ |

### 6.2 ç½‘ç»œè¿é€šæ€§æµ‹è¯•

åœ¨æ¯ä¸ªé£è…¾æ´¾ä¸Šæµ‹è¯•ï¼š

```bash
# æµ‹è¯•èƒ½å¦ ping é€š Hub
ping -c 3 192.168.100.17

# æµ‹è¯• WebSocket Hub ç«¯å£
telnet 192.168.100.17 9000
# æˆ–
nc -zv 192.168.100.17 9000
```

### 6.3 é˜²ç«å¢™é…ç½®ï¼ˆå¦‚æœå¯ç”¨ï¼‰

åœ¨ä¸»èŠ‚ç‚¹ï¼ˆé£è…¾æ´¾ 1ï¼‰ä¸Šï¼š

```bash
# å…è®¸ WebSocket Hub ç«¯å£
sudo ufw allow 9000/tcp

# å…è®¸ HTTP æœåŠ¡å™¨ç«¯å£
sudo ufw allow 8080/tcp

# å¯ç”¨é˜²ç«å¢™
sudo ufw enable
```

---

## ä¸ƒã€ç³»ç»Ÿå¯åŠ¨ä¸æµ‹è¯•

### 7.1 å¯åŠ¨é¡ºåº

**æ¨èå¯åŠ¨é¡ºåº**:

1. **å…ˆå¯åŠ¨ä¸»èŠ‚ç‚¹ï¼ˆé£è…¾æ´¾ 1ï¼‰**
   - Hub å’Œ HTTP Server å¿…é¡»å…ˆè¿è¡Œ

```bash
# é£è…¾æ´¾ 1
sudo systemctl start sagin-hub.service
sudo systemctl start sagin-http.service
sudo systemctl start sagin-node.service
```

2. **ç­‰å¾… 10 ç§’ï¼Œç„¶åå¯åŠ¨æ‰€æœ‰ä»èŠ‚ç‚¹ï¼ˆé£è…¾æ´¾ 2-6ï¼‰**

```bash
# åœ¨æ¯ä¸ªä»èŠ‚ç‚¹ä¸Š
sudo systemctl start sagin-node.service
```

æˆ–è€…è®¾ç½®å¼€æœºè‡ªå¯åï¼ŒæŒ‰é¡ºåºå¼€æœºå³å¯ã€‚

### 7.2 éªŒè¯ç³»ç»ŸçŠ¶æ€

#### 1) æ£€æŸ¥æ§åˆ¶å°

åœ¨ä¸»èŠ‚ç‚¹é£è…¾æ´¾ 1 çš„æµè§ˆå™¨è®¿é—®ï¼š

```
http://192.168.100.17:8080/control-panel/
```

**åº”è¯¥çœ‹åˆ°**:
- åœ¨çº¿èŠ‚ç‚¹: 6/6
- æ´»è·ƒé“¾è·¯: 2-4 æ¡ï¼ˆå–å†³äºæ‹“æ‰‘ï¼‰
- æ€»æµé‡: åŠ¨æ€æ•°æ®ï¼ˆ200-700 KB/sï¼‰
- PQ-NTOR æ¡æ‰‹: æŒç»­å¢é•¿

#### 2) æ£€æŸ¥èŠ‚ç‚¹è§†å›¾

åœ¨æ¯ä¸ªä»èŠ‚ç‚¹çš„æµè§ˆå™¨è®¿é—®ï¼š

```
# é£è…¾æ´¾ 2 (SR èŠ‚ç‚¹)
http://192.168.100.18:8080/node-view/?node_id=SR

# é£è…¾æ´¾ 3 (S1R2 èŠ‚ç‚¹)
http://192.168.100.19:8080/node-view/?node_id=S1R2

# é£è…¾æ´¾ 4 (S1 èŠ‚ç‚¹)
http://192.168.100.20:8080/node-view/?node_id=S1

# é£è…¾æ´¾ 5 (S2 èŠ‚ç‚¹)
http://192.168.100.21:8080/node-view/?node_id=S2

# é£è…¾æ´¾ 6 (T èŠ‚ç‚¹)
http://192.168.100.22:8080/node-view/?node_id=T
```

**æ³¨æ„**: ä»èŠ‚ç‚¹æ²¡æœ‰ HTTP Serverï¼Œéœ€è¦è®¿é—®ä¸»èŠ‚ç‚¹çš„ URL

**æ­£ç¡®æ–¹å¼**:

æ‰€æœ‰èŠ‚ç‚¹è§†å›¾éƒ½ä»ä¸»èŠ‚ç‚¹è®¿é—®ï¼š

```
http://192.168.100.17:8080/node-view/?node_id=SR
http://192.168.100.17:8080/node-view/?node_id=S1R2
http://192.168.100.17:8080/node-view/?node_id=S1
http://192.168.100.17:8080/node-view/?node_id=S2
http://192.168.100.17:8080/node-view/?node_id=T
```

ç„¶ååœ¨å¯¹åº”çš„é£è…¾æ´¾æ˜¾ç¤ºå™¨ä¸Šæ‰“å¼€å¯¹åº”çš„ URLã€‚

#### 3) æ£€æŸ¥ WebSocket è¿æ¥

```bash
# åœ¨ä¸»èŠ‚ç‚¹æŸ¥çœ‹è¿æ¥æ•°
sudo ss -tunlp | grep 9000

# åº”è¯¥çœ‹åˆ° 6 ä¸ªè¿æ¥ï¼ˆ6 ä¸ª Node Agentï¼‰
```

### 7.3 æ‹“æ‰‘åˆ‡æ¢æµ‹è¯•

åœ¨æ§åˆ¶å°ç•Œé¢ï¼š

1. ç‚¹å‡»ä¸åŒçš„æ‹“æ‰‘æŒ‰é’®ï¼ˆ1-12ï¼‰
2. è§‚å¯Ÿé“¾è·¯å˜åŒ–
3. æ£€æŸ¥æ´»è·ƒé“¾è·¯æ•°é‡æ˜¯å¦æ­£ç¡®æ›´æ–°
4. æ£€æŸ¥æ‰€æœ‰èŠ‚ç‚¹è§†å›¾æ˜¯å¦åŒæ­¥åˆ‡æ¢

---

## å…«ã€å¸¸è§é—®é¢˜

### Q1: èŠ‚ç‚¹æ— æ³•è¿æ¥åˆ° Hub

**ç—‡çŠ¶**: æ§åˆ¶å°æ˜¾ç¤º 0/6 æˆ– 1/6 èŠ‚ç‚¹åœ¨çº¿

**æ’æŸ¥æ­¥éª¤**:

```bash
# 1. æ£€æŸ¥ Hub æ˜¯å¦è¿è¡Œ
sudo systemctl status sagin-hub.service

# 2. æ£€æŸ¥ç«¯å£æ˜¯å¦ç›‘å¬
sudo ss -tunlp | grep 9000

# 3. æ£€æŸ¥é˜²ç«å¢™
sudo ufw status

# 4. æ£€æŸ¥èŠ‚ç‚¹ Agent æ—¥å¿—
sudo journalctl -u sagin-node.service -n 50

# 5. æµ‹è¯•ç½‘ç»œè¿é€šæ€§
ping 192.168.100.17
telnet 192.168.100.17 9000
```

**å¸¸è§åŸå› **:
- Hub æœªå¯åŠ¨
- é˜²ç«å¢™é˜»æ­¢è¿æ¥
- IP åœ°å€é…ç½®é”™è¯¯
- HUB_URL é…ç½®é”™è¯¯

### Q2: é¡µé¢æ— æ³•è®¿é—®

**ç—‡çŠ¶**: æµè§ˆå™¨æ— æ³•æ‰“å¼€æ§åˆ¶å°æˆ–èŠ‚ç‚¹è§†å›¾

**æ’æŸ¥æ­¥éª¤**:

```bash
# 1. æ£€æŸ¥ HTTP Server æ˜¯å¦è¿è¡Œ
sudo systemctl status sagin-http.service

# 2. æ£€æŸ¥ç«¯å£ 8080
sudo ss -tunlp | grep 8080

# 3. æ£€æŸ¥é˜²ç«å¢™
sudo ufw status

# 4. æœ¬åœ°æµ‹è¯•
curl http://localhost:8080/control-panel/
```

### Q3: é•œåƒçƒ§å½•åæ— æ³•å¯åŠ¨

**å¯èƒ½åŸå› **:
- SD å¡æŸå
- çƒ§å½•ä¸å®Œæ•´
- é•œåƒæ–‡ä»¶æŸå

**è§£å†³æ–¹æ³•**:
- é‡æ–°çƒ§å½•
- æ›´æ¢ SD å¡
- éªŒè¯é•œåƒ MD5/SHA256

### Q4: ä»èŠ‚ç‚¹æ˜¾ç¤ºé‡å¤çš„èŠ‚ç‚¹ ID

**åŸå› **: å¿˜è®°ä¿®æ”¹èŠ‚ç‚¹ ID

**è§£å†³**:

```bash
# ç¼–è¾‘æœåŠ¡é…ç½®
sudo nano /etc/systemd/system/sagin-node.service

# ä¿®æ”¹ NODE_ID å’Œ NODE_ROLE
# é‡æ–°åŠ è½½å¹¶é‡å¯
sudo systemctl daemon-reload
sudo systemctl restart sagin-node.service
```

### Q5: æµé‡æ˜¾ç¤ºä¸º 0

**æ’æŸ¥**:

```bash
# æ£€æŸ¥ WebSocket Hub æ˜¯å¦è½¬å‘ traffic æ•°æ®
sudo journalctl -u sagin-hub.service | grep traffic

# æ£€æŸ¥ Node Agent æ˜¯å¦å‘é€ traffic
sudo journalctl -u sagin-node.service | grep traffic
```

å¦‚æœçœ‹ä¸åˆ° traffic ç›¸å…³æ—¥å¿—ï¼Œæ£€æŸ¥ä»£ç æ˜¯å¦åŒ…å«æœ€æ–°çš„ traffic ä¿®å¤ã€‚

---

## ä¹ã€é™„å½•

### A. æœåŠ¡ç®¡ç†å‘½ä»¤

```bash
# å¯åŠ¨æœåŠ¡
sudo systemctl start sagin-hub.service
sudo systemctl start sagin-node.service
sudo systemctl start sagin-http.service

# åœæ­¢æœåŠ¡
sudo systemctl stop sagin-hub.service
sudo systemctl stop sagin-node.service
sudo systemctl stop sagin-http.service

# é‡å¯æœåŠ¡
sudo systemctl restart sagin-hub.service
sudo systemctl restart sagin-node.service
sudo systemctl restart sagin-http.service

# æŸ¥çœ‹çŠ¶æ€
sudo systemctl status sagin-hub.service
sudo systemctl status sagin-node.service
sudo systemctl status sagin-http.service

# æŸ¥çœ‹æ—¥å¿—
sudo journalctl -u sagin-hub.service -f
sudo journalctl -u sagin-node.service -f
sudo journalctl -u sagin-http.service -f

# å¼€æœºè‡ªå¯
sudo systemctl enable sagin-hub.service
sudo systemctl enable sagin-node.service
sudo systemctl enable sagin-http.service

# ç¦ç”¨å¼€æœºè‡ªå¯
sudo systemctl disable sagin-hub.service
sudo systemctl disable sagin-node.service
sudo systemctl disable sagin-http.service
```

### B. å¿«é€Ÿéƒ¨ç½²è„šæœ¬

åˆ›å»ºä¸€é”®é…ç½®è„šæœ¬ `scripts/setup_node.sh`:

```bash
#!/bin/bash
# å¿«é€Ÿé…ç½®ä»èŠ‚ç‚¹è„šæœ¬

echo "SAGIN 6+1 èŠ‚ç‚¹é…ç½®å‘å¯¼"
echo "======================="
echo ""

read -p "è¯·è¾“å…¥èŠ‚ç‚¹ ID (SAT/SR/S1R2/S1/S2/T): " NODE_ID
read -p "è¯·è¾“å…¥èŠ‚ç‚¹è§’è‰² (satellite/aircraft/ground): " NODE_ROLE
read -p "è¯·è¾“å…¥ IP åœ°å€æœ€åä¸€ä½ (17-22): " IP_LAST

IP_ADDR="192.168.100.$IP_LAST"

echo ""
echo "é…ç½®ä¿¡æ¯:"
echo "  èŠ‚ç‚¹ ID: $NODE_ID"
echo "  èŠ‚ç‚¹è§’è‰²: $NODE_ROLE"
echo "  IP åœ°å€: $IP_ADDR"
echo ""
read -p "ç¡®è®¤é…ç½®? (y/n): " CONFIRM

if [[ "$CONFIRM" != "y" ]]; then
    echo "å–æ¶ˆé…ç½®"
    exit 0
fi

# ä¿®æ”¹ IP åœ°å€
echo "è®¾ç½® IP åœ°å€..."
sudo nmcli con mod "æœ‰çº¿è¿æ¥ 1" ipv4.addresses $IP_ADDR/24
sudo nmcli con mod "æœ‰çº¿è¿æ¥ 1" ipv4.gateway 192.168.100.1
sudo nmcli con mod "æœ‰çº¿è¿æ¥ 1" ipv4.dns "8.8.8.8"
sudo nmcli con mod "æœ‰çº¿è¿æ¥ 1" ipv4.method manual
sudo nmcli con up "æœ‰çº¿è¿æ¥ 1"

# ä¿®æ”¹èŠ‚ç‚¹é…ç½®
echo "é…ç½®èŠ‚ç‚¹æœåŠ¡..."
sudo sed -i "s/Environment=\"NODE_ID=.*\"/Environment=\"NODE_ID=$NODE_ID\"/" /etc/systemd/system/sagin-node.service
sudo sed -i "s/Environment=\"NODE_ROLE=.*\"/Environment=\"NODE_ROLE=$NODE_ROLE\"/" /etc/systemd/system/sagin-node.service

# ç¦ç”¨ä¸éœ€è¦çš„æœåŠ¡ï¼ˆä»èŠ‚ç‚¹ï¼‰
if [[ "$IP_LAST" != "17" ]]; then
    echo "ç¦ç”¨ Hub å’Œ HTTP Server (ä»èŠ‚ç‚¹)..."
    sudo systemctl disable sagin-hub.service
    sudo systemctl disable sagin-http.service
fi

# é‡æ–°åŠ è½½å¹¶å¯åŠ¨
echo "é‡æ–°åŠ è½½æœåŠ¡..."
sudo systemctl daemon-reload
sudo systemctl restart sagin-node.service

echo ""
echo "é…ç½®å®Œæˆï¼"
echo "èŠ‚ç‚¹æœåŠ¡çŠ¶æ€:"
sudo systemctl status sagin-node.service --no-pager
```

### C. èŠ‚ç‚¹ ID ä¸è§’è‰²å¯¹ç…§è¡¨

| èŠ‚ç‚¹ ID | èŠ‚ç‚¹åç§° | èŠ‚ç‚¹è§’è‰² | EMOJI | æè¿° |
|---------|---------|---------|-------|------|
| SAT | å«æ˜Ÿ | satellite | ğŸ›° | å¤©åŸºèŠ‚ç‚¹ï¼Œé«˜è½¨å«æ˜Ÿ |
| SR | æ— äººæœº1 | aircraft | âœˆï¸ | ç©ºåŸºä¸­ç»§èŠ‚ç‚¹ |
| S1R2 | æ— äººæœº2 | aircraft | ğŸš | ç©ºåŸºä¸­ç»§èŠ‚ç‚¹ |
| S1 | ç»ˆç«¯1 | ground | ğŸ“± | åœ°é¢ç”¨æˆ·ï¼Œè¿‘ç«¯ |
| S2 | ç»ˆç«¯2 | ground | ğŸ“± | åœ°é¢ç”¨æˆ·ï¼Œè¿œç«¯ |
| T | ç»ˆç«¯3 | ground | ğŸ“± | åœ°é¢ç”¨æˆ·ï¼Œç‹¬ç«‹ |

### D. ç³»ç»Ÿæ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   å‰ç«¯ (Frontend)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  æµè§ˆå™¨ 1: http://192.168.100.17:8080/control-panel/    â”‚
â”‚            (æ§åˆ¶å°ï¼Œæ˜¾ç¤ºå…¨å±€çŠ¶æ€)                          â”‚
â”‚                                                          â”‚
â”‚  æµè§ˆå™¨ 2-6: http://192.168.100.17:8080/node-view/...   â”‚
â”‚              (èŠ‚ç‚¹è§†å›¾ï¼Œå„è‡ªèŠ‚ç‚¹è§†è§’)                      â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ WebSocket (ws://...17:9000)
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   åç«¯ (Backend)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                          â”‚
â”‚  WebSocket Hub (é£è…¾æ´¾ 1)                                â”‚
â”‚    - æ¥æ”¶æ‰€æœ‰èŠ‚ç‚¹çŠ¶æ€                                     â”‚
â”‚    - å¹¿æ’­æ‹“æ‰‘åˆ‡æ¢å‘½ä»¤                                     â”‚
â”‚    - è½¬å‘å®æ—¶æ•°æ®                                        â”‚
â”‚                                                          â”‚
â”‚  Node Agent Ã— 6 (é£è…¾æ´¾ 1-6)                             â”‚
â”‚    - æ¨¡æ‹ŸèŠ‚ç‚¹çŠ¶æ€                                        â”‚
â”‚    - ç”Ÿæˆæµé‡æ•°æ®                                        â”‚
â”‚    - ä¸ŠæŠ¥åˆ° Hub                                          â”‚
â”‚                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

**éƒ¨ç½²å®Œæˆæ£€æŸ¥æ¸…å•**:

- [ ] ä¸»èŠ‚ç‚¹ç¯å¢ƒæ£€æµ‹é€šè¿‡
- [ ] æ‰€æœ‰ä¾èµ–å®‰è£…å®Œæˆ
- [ ] systemd æœåŠ¡é…ç½®æ­£ç¡®
- [ ] ç½‘ç»œ IP é…ç½®æ­£ç¡®
- [ ] ç³»ç»Ÿé•œåƒåˆ¶ä½œæˆåŠŸ
- [ ] é•œåƒçƒ§å½•åˆ° 5 ä¸ªä»èŠ‚ç‚¹
- [ ] æ¯ä¸ªä»èŠ‚ç‚¹ä¿®æ”¹èŠ‚ç‚¹ ID å’Œ IP
- [ ] ç¦ç”¨ä»èŠ‚ç‚¹çš„ Hub å’Œ HTTP æœåŠ¡
- [ ] æ‰€æœ‰èŠ‚ç‚¹èƒ½ ping é€šä¸»èŠ‚ç‚¹
- [ ] æ§åˆ¶å°æ˜¾ç¤º 6/6 èŠ‚ç‚¹åœ¨çº¿
- [ ] èŠ‚ç‚¹è§†å›¾æ­£å¸¸æ˜¾ç¤º
- [ ] æ‹“æ‰‘åˆ‡æ¢åŠŸèƒ½æ­£å¸¸
- [ ] æµé‡å’Œæ¡æ‰‹æ•°æ®æ­£å¸¸æ›´æ–°

---

**æ–‡æ¡£ç‰ˆæœ¬**: v1.0
**æœ€åæ›´æ–°**: 2025-11-20
**æŠ€æœ¯æ”¯æŒ**: æŸ¥çœ‹ `readme/` ç›®å½•ä¸‹çš„å…¶ä»–æ–‡æ¡£
