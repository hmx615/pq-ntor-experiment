# 3D地球可视化DEMO使用说明

**创建时间**: 2025-11-14
**文件位置**: `/home/ccc/pq-ntor-experiment/sagin-experiments/demo/3d_globe_demo.html`
**技术栈**: Globe.GL + Three.js

---

## 📋 目录

1. [快速开始](#快速开始)
2. [功能特性](#功能特性)
3. [界面说明](#界面说明)
4. [技术实现](#技术实现)
5. [已实现拓扑](#已实现拓扑)
6. [下一步计划](#下一步计划)

---

## 🚀 快速开始

### 方法1: 本地浏览器打开

```bash
# 直接用浏览器打开HTML文件
firefox /home/ccc/pq-ntor-experiment/sagin-experiments/demo/3d_globe_demo.html

# 或者用默认浏览器
xdg-open /home/ccc/pq-ntor-experiment/sagin-experiments/demo/3d_globe_demo.html
```

### 方法2: 启动本地HTTP服务器

```bash
# 进入demo目录
cd /home/ccc/pq-ntor-experiment/sagin-experiments/demo

# 启动简单HTTP服务器
python3 -m http.server 8080

# 然后在浏览器访问
# http://localhost:8080/3d_globe_demo.html
```

### 方法3: 在飞腾派上访问

```bash
# 如果在飞腾派上启动HTTP服务器
cd /home/ccc/pq-ntor-experiment/sagin-experiments/demo
python3 -m http.server 8080

# 然后在另一台电脑的浏览器访问
# http://192.168.5.110:8080/3d_globe_demo.html
```

---

## ✨ 功能特性

### 1. 3D地球可视化
- ✅ 真实地球夜景纹理
- ✅ 大气层光晕效果
- ✅ 自动旋转动画
- ✅ 鼠标交互控制(缩放、旋转、拖动)

### 2. 网络拓扑展示
- ✅ 卫星节点 (黄色，高轨道)
- ✅ 无人机节点 (青色，低空)
- ✅ 地面终端节点 (绿色，地表)
- ✅ 链路连线与标注

### 3. RSSI可视化
- ✅ 高RSSI链路: 绿色实线
- ✅ 低RSSI链路: 橙色实线
- ✅ 协作链路: 紫色虚线动画

### 4. 拓扑切换功能
- ✅ 12个按钮对应12种拓扑
- ✅ 上行/下行分组显示
- ✅ 点击切换实时更新
- ✅ 当前拓扑高亮显示

### 5. 信息面板
- ✅ 实时显示当前拓扑名称
- ✅ 节点/链路图例
- ✅ 统计信息 (节点数、链路数)
- ✅ PQ-Tor握手状态模拟

---

## 🖥️ 界面说明

### 左上角 - 信息面板
```
┌─────────────────────────────┐
│ 🛰️ SAGIN NOMA演示系统      │
│                             │
│ 当前拓扑: 拓扑1 - Z1 Up     │
│ 类型: 上行通信 / 直连NOMA   │
│                             │
│ 节点图例:                   │
│ 🟡 卫星 (SAT)              │
│ 🔵 无人机 (Aircraft)       │
│ 🟢 地面终端 (Ground)       │
│                             │
│ 链路图例:                   │
│ ━━ 高RSSI (优秀)           │
│ ━━ 低RSSI (一般)           │
│ ━━ 协作链路                │
└─────────────────────────────┘
```

### 右上角 - 拓扑选择器
```
┌─────────────────────────────┐
│ 🎯 拓扑选择器               │
│                             │
│ ⬆️ 上行通信 (6种)          │
│ [拓扑1] [拓扑2] [拓扑3]     │
│ [拓扑4] [拓扑5] [拓扑6]     │
│                             │
│ ⬇️ 下行通信 (6种)          │
│ [拓扑7] [拓扑8] [拓扑9]     │
│ [拓扑10] [拓扑11] [拓扑12]  │
└─────────────────────────────┘
```

### 左下角 - 实时统计
```
┌─────────────────────────────┐
│ 📊 实时统计                 │
│ 节点数: 3                   │
│ 链路数: 2                   │
│ PQ-Tor握手: 就绪 ✓          │
└─────────────────────────────┘
```

---

## 🔧 技术实现

### 核心技术栈

```javascript
// 主要库
Globe.GL v2.x        // 3D地球可视化
Three.js             // 3D渲染引擎 (Globe.GL依赖)

// CDN资源
- Globe.GL库: //unpkg.com/globe.gl
- 地球纹理: //unpkg.com/three-globe/example/img/earth-night.jpg
```

### 数据结构

#### 节点数据格式
```javascript
{
    id: "SAT",                           // 节点唯一ID
    lat: 0,                              // 纬度
    lng: 0,                              // 经度
    alt: 0.5,                            // 高度 (相对地球半径)
    label: "卫星 SAT",                   // 显示标签
    type: "satellite"                    // 节点类型
}
```

#### 链路数据格式
```javascript
{
    source: "S2",                        // 源节点ID
    target: "SAT",                       // 目标节点ID
    rssi: "low",                         // RSSI等级 (high/low/coop)
    label: "低RSSI天基上行 (30ms, 20Mbps)" // 链路描述
}
```

### 颜色编码

| 元素 | 颜色 | 十六进制 | 含义 |
|------|------|----------|------|
| 卫星节点 | 🟡 黄色 | #ffff00 | 天基节点 |
| 无人机节点 | 🔵 青色 | #00ffff | 空基中继 |
| 地面终端 | 🟢 绿色 | #00ff00 | 地基用户 |
| 高RSSI链路 | 🟢 绿色 | #00ff00 | 信道质量好 |
| 低RSSI链路 | 🟠 橙色 | #ff9900 | 信道质量一般 |
| 协作链路 | 🟣 紫色 | #ff00ff | NOMA组内协作 |

### 交互功能

```javascript
// 鼠标悬停 - 显示详细信息
pointLabel(d => `
    节点: ${d.label}
    类型: ${d.type}
    位置: ${d.lng}°, ${d.lat}°
`);

// 链路悬停 - 显示链路参数
arcLabel(d => `
    ${d.source} → ${d.target}
    ${d.label}
`);

// 按钮点击 - 切换拓扑
switchTopology(topoId);
```

---

## 📊 已实现拓扑

### 当前DEMO包含4种完整拓扑

#### 拓扑1: Z1 Up-1 (直连NOMA)
```
节点: SAT, S1(无人机), S2(地面)
链路: S2→SAT (低RSSI), S1→SAT (高RSSI)
特点: 上行直连，无协作
```

#### 拓扑2: Z1 Up-2 (混合协作)
```
节点: SAT, S2/R1(地面), S1/R2(无人机)
链路: S2/R1→S1/R2 (空地), S1/R2→SAT (高RSSI)
特点: 1跳中继
```

#### 拓扑3: Z2 Up-1 (2跳协作)
```
节点: SAT, S/R(无人机中继), T1(地面), T2(地面)
链路: T1→S/R (高RSSI), T2→S/R (低RSSI), S/R→SAT
特点: 2跳汇聚
```

#### 拓扑7: Z1 Down (直连NOMA+协作)
```
节点: SAT, S1(无人机), S2(地面)
链路: SAT→S1, SAT→S2, S1→S2 (协作)
特点: 下行+NOMA组内协作
```

### 拓扑4-6, 8-12
- **状态**: 数据结构已定义
- **TODO**: 需要补充完整节点/链路数据
- **位置**: HTML文件第164-167行

---

## 🎯 下一步计划

### 短期 (今天-明天)

1. **补充剩余8种拓扑**
   - [ ] 拓扑4: Z2 Up-2
   - [ ] 拓扑5: Z3 Up-1
   - [ ] 拓扑6: Z3 Up-2
   - [ ] 拓扑8: Z2 Down
   - [ ] 拓扑9: Z3 Down
   - [ ] 拓扑10: H1 Down-1
   - [ ] 拓扑11: H1 Down-2
   - [ ] 拓扑12: H2 Down

2. **增强交互功能**
   - [ ] 添加数据流动画 (粒子流)
   - [ ] 显示实时延迟/带宽数值
   - [ ] 节点点击高亮功能
   - [ ] 链路激活状态显示

3. **集成PQ-Tor**
   - [ ] 添加WebSocket连接后端
   - [ ] 实时显示握手状态
   - [ ] 显示电路建立过程
   - [ ] 数据传输可视化

### 中期 (本周)

4. **后端API开发**
   ```bash
   Flask API服务器
   ├── /api/topology/list        # 获取拓扑列表
   ├── /api/topology/{id}/load   # 加载指定拓扑
   ├── /api/pqtor/handshake      # 执行握手
   └── /api/stats/realtime       # 实时统计
   ```

5. **Docker容器管理**
   - [ ] 自动创建/销毁容器
   - [ ] 应用网络参数模拟
   - [ ] 容器健康检查
   - [ ] 日志收集

6. **性能测试**
   - [ ] 延迟测试 (ping)
   - [ ] 吞吐量测试 (iperf3)
   - [ ] PQ-Tor握手时间测量
   - [ ] 电路建立时间统计

### 长期 (下周)

7. **多飞腾派部署**
   - [ ] 分布式拓扑 (节点分散在不同设备)
   - [ ] 跨设备通信
   - [ ] 集中管理界面
   - [ ] 物理位置映射

8. **Cesium升级** (可选)
   - [ ] 更逼真的地球渲染
   - [ ] 卫星轨道动画
   - [ ] 地形高度数据
   - [ ] 时间序列回放

---

## 🐛 已知问题

### 问题1: CDN依赖
- **描述**: 需要互联网连接加载Globe.GL库
- **解决方案**: 下载库文件到本地
  ```bash
  wget https://unpkg.com/globe.gl -O globe.gl.js
  # 修改HTML中的<script src="...">
  ```

### 问题2: 飞腾派性能
- **描述**: ARM设备可能渲染较慢
- **解决方案**:
  - 降低地球分辨率
  - 减少节点/链路数量
  - 关闭抗锯齿

### 问题3: 坐标位置
- **描述**: 当前使用假坐标 (北京、上海)
- **解决方案**: 根据实际演示需求调整经纬度

---

## 📚 参考资源

### 官方文档
- **Globe.GL**: https://github.com/vasturiano/globe.gl
- **Three.js**: https://threejs.org/docs/

### 示例代码
- **Basic Globe**: https://github.com/vasturiano/globe.gl#quick-start
- **Arcs Example**: https://vasturiano.github.io/globe.gl/example/airline-routes/

### 相关文档
- `3D地球可视化技术调研报告.md` - 技术选型
- `12种NOMA网络拓扑定义.md` - 拓扑定义
- `RSSI网络参数映射方案.md` - 参数映射

---

## 💡 使用技巧

### 1. 地球交互
- **旋转**: 鼠标左键拖动
- **缩放**: 鼠标滚轮
- **自动旋转**: 默认开启，拖动后停止

### 2. 节点查看
- **悬停节点**: 显示详细信息
- **悬停链路**: 显示链路参数

### 3. 拓扑切换
- 点击右侧按钮立即切换
- 观察统计面板变化
- 注意PQ-Tor握手状态

### 4. 性能优化
- 如果卡顿，刷新页面
- 关闭其他标签页
- 使用Chrome/Edge浏览器 (性能更好)

---

## 🎬 演示流程建议

### 场景1: 基础演示 (5分钟)
1. 打开页面，展示3D地球
2. 介绍拓扑1 (Z1 Up-1直连场景)
3. 切换到拓扑7 (Z1 Down协作场景)
4. 对比上行/下行区别

### 场景2: 完整演示 (15分钟)
1. 依次展示12种拓扑
2. 讲解每种拓扑特点
3. 对比RSSI差异
4. 演示拓扑切换流程

### 场景3: 技术深入 (30分钟)
1. 查看节点详细信息
2. 悬停链路查看参数
3. 对比不同链路延迟/带宽
4. 说明PQ-Tor握手过程

---

**文档状态**: ✅ 完成
**DEMO状态**: ✅ 可用 (4种拓扑)
**下一步**: 补充剩余8种拓扑数据

---

**创建者**: Claude AI Assistant
**最后更新**: 2025-11-14
**版本**: v1.0-mvp
