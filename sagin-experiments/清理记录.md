# 6+1展示系统清理记录

**清理时间**: 2025-11-27
**目的**: 清理旧版本文件，保留唯一正确的运行版本

---

## 清理前的问题

系统中存在多个版本的启动脚本和文件，可能导致：
1. 启动错误的版本
2. 文件混乱难以维护
3. 不确定哪个是正确版本

---

## 清理内容

### 1. 归档旧版本启动脚本

**归档位置**: `archive/old_scripts/`

| 文件名 | 原因 | 归档日期 |
|-------|------|---------|
| `start_6plus1_system.sh` | 早期版本，功能不完整 | 2025-11-27 |
| `start_distributed_demo.sh` | 分布式版本，已弃用 | 2025-11-27 |
| `start_for_phytium.sh` | 飞腾派专用版本，已合并到正确版本 | 2025-11-27 |
| `demo/start_demo.sh` | Demo版本，已弃用 | 2025-11-27 |

### 2. 归档旧版本后端文件

**归档位置**: `archive/old_backend/`

| 文件名 | 原因 | 归档日期 |
|-------|------|---------|
| `demo_agent.py` | Demo版本的agent，功能简化 | 2025-11-27 |
| `node_agent_lite.py` | 精简版agent，已被完整版替代 | 2025-11-27 |
| `test_lite_agent_wsl.py` | 测试脚本，不再使用 | 2025-11-27 |
| `start_all_demo_nodes.py` | Demo启动脚本，已弃用 | 2025-11-27 |

### 3. 归档整个demo目录

**归档位置**: `archive/old_demo/` (2.0 MB)

**内容**: 包含早期开发的各种demo HTML文件：
- `3d_globe_demo.html`
- `3d_globe_demo_v2.html`
- `3d_globe_demo_v3.html`
- `3d_globe_final.html`
- `3d_globe_local.html`
- `2d_topo_demo.html`
- 等等...

**原因**: 这些都是开发过程中的实验版本，最终版本已整合到 `frontend/` 目录

---

## 保留的正确版本

### 当前系统结构

```
sagin-experiments/
├── start_correct_version.sh          ✅ 唯一启动脚本
├── backend/
│   ├── websocket_hub.py              ✅ WebSocket中心（未修改）
│   └── node_agent.py                 ✅ 节点Agent（完整版本）
├── frontend/
│   ├── control-panel/
│   │   └── index.html                ✅ 控制面板（完整功能）
│   └── node-view/
│       └── index.html                ✅ 节点视图（3D地球）
├── noma-topologies/
│   └── configs/                      ✅ 12个拓扑配置
└── scripts/
    ├── deploy_all.sh                 ✅ 部署脚本
    ├── start_all_agents.sh           ✅ Agent启动脚本
    └── ...                           （其他工具脚本）
```

### 正确版本的特性

**`start_correct_version.sh`** 包含：
- ✅ 启动 WebSocket Hub (端口 9000)
- ✅ 启动 6 个节点 (SAT, UAV1, UAV2, Ground1, Ground2, Ground3)
- ✅ 启动前端服务 (端口 8080)
- ✅ 绑定到 0.0.0.0 支持远程访问

**`frontend/control-panel/index.html`** 包含：
- ✅ 左上角实时时间显示
- ✅ 左下角链路图例（绿色/橙色/紫色）
- ✅ 12个拓扑完整支持
- ✅ Topo 7-12 显示紫色协作NOMA链路

**`frontend/node-view/index.html`** 包含：
- ✅ 3D 地球渲染
- ✅ 实时节点位置更新
- ✅ 链路连线显示
- ✅ 支持 6 个节点视角切换

**`backend/node_agent.py`** 包含：
- ✅ 完整的节点状态管理
- ✅ 实时位置更新
- ✅ 链路状态上报
- ✅ 12个拓扑定义

---

## 当前运行状态

### 进程检查

```bash
# Hub
$ ps aux | grep websocket_hub.py | grep -v grep
ccc  1578054  0.2  0.1  32132 24832 ?  S  Nov27  1:10  python3 websocket_hub.py

# 节点 (3个)
$ ps aux | grep node_agent.py | grep -v grep
ccc  1578064  0.0  0.1 104072 23808 ?  Sl  Nov27  0:12  python3 node_agent.py
ccc  1578065  0.0  0.1 104072 23552 ?  Sl  Nov27  0:12  python3 node_agent.py
ccc  1578066  0.0  0.1 104072 23552 ?  Sl  Nov27  0:12  python3 node_agent.py
```

**状态**: ✅ 系统正常运行

**说明**: 显示只有 3 个节点，可能是部分节点未启动或已退出

---

## 访问地址

### WSL本地访问

控制面板:
```
http://localhost:8080/control-panel/
```

节点视图:
```
http://localhost:8080/node-view/index.html?node_id=SAT
http://localhost:8080/node-view/index.html?node_id=UAV1
http://localhost:8080/node-view/index.html?node_id=UAV2
http://localhost:8080/node-view/index.html?node_id=Ground1
http://localhost:8080/node-view/index.html?node_id=Ground2
http://localhost:8080/node-view/index.html?node_id=Ground3
```

### 飞腾派远程访问

控制面板:
```
http://192.168.5.83:8080/control-panel/
```

节点视图:
```
http://192.168.5.83:8080/node-view/index.html?node_id=SAT
http://192.168.5.83:8080/node-view/index.html?node_id=UAV1
...
```

---

## 常用命令

### 启动系统

```bash
cd /home/ccc/pq-ntor-experiment/sagin-experiments
./start_correct_version.sh
```

### 停止系统

```bash
pkill -f websocket_hub.py
pkill -f node_agent.py
pkill -f "http.server.*8080"
```

### 查看日志

```bash
# Hub日志
tail -f /tmp/hub.log

# 节点日志
tail -f /tmp/SAT.log
tail -f /tmp/UAV1.log
tail -f /tmp/Ground1.log

# 前端日志
tail -f /tmp/frontend.log
```

### 检查进程

```bash
ps aux | grep -E "(websocket_hub|node_agent|http.server)" | grep -v grep
```

---

## 归档文件恢复

如果需要恢复归档的文件：

```bash
# 恢复启动脚本
cp archive/old_scripts/start_6plus1_system.sh .

# 恢复后端文件
cp archive/old_backend/demo_agent.py backend/

# 恢复demo目录
cp -r archive/old_demo demo/
```

**建议**: 不建议恢复，当前版本已包含所有功能

---

## 文件大小统计

```bash
$ du -sh archive/*
16K	    archive/old_backend
2.0M	archive/old_demo
16K	    archive/old_scripts
```

**总计**: 约 2.0 MB

---

## 清理效果

### 清理前

- 5 个不同的启动脚本
- 4 个旧版本后端文件
- 1 个 demo 目录 (包含 20+ 个实验文件)
- 目录混乱，不确定哪个是正确版本

### 清理后

- ✅ **1 个** 唯一启动脚本 (`start_correct_version.sh`)
- ✅ **2 个** 核心后端文件 (`websocket_hub.py`, `node_agent.py`)
- ✅ **清晰的** frontend 目录结构
- ✅ **明确的** 系统版本

---

## 维护建议

1. **不要创建新的启动脚本**
   - 所有修改直接在 `start_correct_version.sh` 中进行
   - 如需测试，使用临时脚本并在完成后删除

2. **不要创建新的 agent 变体**
   - 所有功能在 `node_agent.py` 中统一实现
   - 使用环境变量或参数控制不同行为

3. **前端修改直接在 frontend/ 目录**
   - 不要创建 demo 或 test 目录
   - 开发新功能使用 git 分支

4. **定期清理日志**
   ```bash
   rm /tmp/*.log
   ```

5. **归档过时版本**
   - 重要的历史版本保留在 `archive/` 目录
   - 不重要的直接删除

---

## 下一步

当前系统已清理完毕，建议：

1. **重启系统验证**
   ```bash
   pkill -f websocket_hub.py
   pkill -f node_agent.py
   pkill -f "http.server.*8080"
   ./start_correct_version.sh
   ```

2. **检查6个节点是否全部启动**
   ```bash
   ps aux | grep node_agent.py | grep -v grep | wc -l
   # 应该显示 6
   ```

3. **访问前端确认功能正常**
   - 控制面板: http://localhost:8080/control-panel/
   - 12个拓扑切换正常
   - 时间显示正常
   - 图例显示正常

---

**清理完成时间**: 2025-11-27
**状态**: ✅ 清理完成，系统简化
**归档文件**: 已安全保存在 `archive/` 目录
