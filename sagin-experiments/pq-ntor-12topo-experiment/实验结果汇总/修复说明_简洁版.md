# 12拓扑实验修复说明 (简洁版)

## 问题

12拓扑实验全部超时 (0/24成功)

**原因**: Directory返回硬编码的SAGIN网络IP (172.20.x.x)，本地环境无法连接

## 解决方案

添加**本地模式** (LOCAL_MODE):

1. **Directory**: 支持动态节点注册
   - 新增 `POST /register` API
   - Relay启动时自动注册

2. **编译标志**: `-DUSE_LOCAL_MODE=1`

3. **工作流程**:
   ```
   Directory启动 → Relay注册(127.0.0.1) → Client查询 → 连接成功
   ```

## 修改文件

| 文件 | 修改 |
|------|------|
| `directory_server.c` | 添加条件编译 + 动态注册 |
| `relay_node.c` | 添加启动时注册 |
| `relay_registration.c` | 新建注册客户端 |
| `Makefile` | 添加 `-DUSE_LOCAL_MODE=1` |

## 部署

```bash
# 自动部署到飞腾派
python3 /home/ccc/pq-ntor-experiment/apply_local_mode_fix.py

# 运行测试
python3 /home/ccc/pq-ntor-experiment/simple_run_12topo.py
```

## 详细文档

参考: `LOCAL_MODE_FIX.md`

---

**日期**: 2025-11-27
**状态**: ✅ 已部署，测试中
