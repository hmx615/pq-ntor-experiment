# 12拓扑Classic vs PQ-NTOR对比实验实现方案

## 实验目标

在相同的12种SAGIN NOMA拓扑网络条件下，对比Classic NTOR和PQ-NTOR的性能。

---

## 实验设计

### 第一部分：本地算法性能对比 ✅（已完成）

**环境**：无网络延迟，纯算法计算
- Classic NTOR: 0.156 ms (100次)
- PQ-NTOR: 0.031 ms (1000次)
- **结论**：PQ快5倍

### 第二部分：12拓扑网络仿真对比 🔄（进行中）

**环境**：Linux tc/netem网络仿真
- 12种拓扑 × 2种协议 × 10次运行 = 240次测试
- 网络延迟：90-240ms
- 带宽：22-60 Mbps
- 丢包率：0.5-2.5%

**已完成**：
- ✅ PQ-NTOR: 120次测试（12拓扑 × 10次），100%成功

**待完成**：
- ⏳ Classic NTOR: 120次测试（12拓扑 × 10次）

---

## 实现方案

### 方案A：最简单方案（推荐）⭐

**不修改代码，直接使用现有数据 + 理论分析**

#### 理由

1. **握手时间差异已知**：
   - Classic: 0.156 ms
   - PQ: 0.031 ms
   - 差异：0.125 ms

2. **网络延迟主导**：
   - SAGIN网络延迟：90-240 ms
   - 握手差异占比：0.125 / 90 = 0.14% （可忽略）

3. **消息大小可计算**：
   - Classic带宽占用 = 116B / 传输时间
   - PQ带宽占用 = 1620B / 传输时间
   - 在50Mbps下，额外传输时间 = (1620-116)×8 / 50,000,000 = 0.24 ms

#### 论文呈现

**表1：算法层面性能对比**
| 指标 | Classic | PQ | 差异 |
|------|---------|----|----- |
| 握手时间 | 0.156ms | 0.031ms | -80% |
| 消息大小 | 116B | 1620B | +1397% |

**表2：12拓扑网络影响分析**
| 拓扑 | 网络延迟 | 握手差异占比 | 消息传输差异 | 总影响 |
|------|----------|--------------|--------------|--------|
| T01 | 90ms | 0.14% | 0.24ms | <0.5% |
| ... | ... | ... | ... | ... |

**结论**：
> "由于握手时间差异(0.125ms)和额外消息传输时间(0.24ms)相比SAGIN网络延迟(90-240ms)极小，Classic和PQ-NTOR在网络层面的性能差异可忽略(<0.5%)。因此，我们重点测试了PQ-NTOR在12种拓扑下的完整性能，验证了其在SAGIN场景的可行性。"

---

### 方案B：完整实现方案（如果有时间）

**实现Classic NTOR版本的客户端，跑完整的120次测试**

#### 实现步骤

##### Step 1: 创建Classic版本的客户端

有两种方式：

**方式1：添加运行时开关**（推荐）
```c
// 在client_main.c中添加 --classic 参数
// 在tor_client.c中添加 use_classic 标志
// 根据标志调用 classic_ntor_* 或 pq_ntor_* 函数
```

**方式2：编译两个版本**
```makefile
# Makefile中添加
CLIENT_CLASSIC = client_classic
$(CLIENT_CLASSIC): $(CLIENT_SRC) $(CLIENT_OBJS) $(OBJS)
    $(CC) $(CFLAGS) -DUSE_CLASSIC_NTOR $(INCLUDES) -o $@ $^ $(LIBS)
```

##### Step 2: 修改测试脚本

```python
# run_pq_ntor_12topologies.py 添加 --mode 参数
parser.add_argument('--mode', choices=['pq', 'classic'], default='pq',
                    help='使用PQ-NTOR或Classic NTOR')

# 根据mode选择client或client_classic
if args.mode == 'classic':
    client_prog = './client_classic'
else:
    client_prog = './client'
```

##### Step 3: 运行测试

```bash
# 运行Classic NTOR测试
python3 run_pq_ntor_12topologies.py --mode classic --runs 10

# 已有PQ-NTOR数据，无需重跑
```

##### Step 4: 生成对比报告

```python
# 创建新脚本 compare_12topologies.py
# 对比相同拓扑下的Classic vs PQ性能
```

#### 工作量估算

- 修改代码：2-3小时
- 运行测试：2.5小时（120次）
- 生成报告：1小时
- **总计：约6小时**

---

### 方案C：飞腾派硬件验证（可选，论文加分项）

**在真实硬件上验证部分拓扑**

#### 实验设计

选择3个代表性拓扑：
- 拓扑01（低延迟，高带宽）
- 拓扑06（最低延迟）
- 拓扑11（最高延迟）

每个拓扑运行：
- Classic × 5次
- PQ × 5次

#### 意义

1. **ARM vs x86对比**：飞腾派是ARM架构
2. **真实硬件验证**：非仿真环境
3. **分布式部署**：真实的网络通信开销

#### 工作量

- 部署准备：2小时
- 运行测试：1小时
- 数据分析：1小时
- **总计：约4小时**

---

## 推荐实施计划

### 时间紧张（1-2天）

✅ **采用方案A**
- 使用现有数据
- 理论分析网络影响
- 重点论述"网络延迟主导效应"
- **优势**：节省时间，数据充分，论点清晰

### 时间充足（3-5天）

✅ **方案B（完整12拓扑对比）**
- 实现Classic客户端
- 跑120次测试
- 生成完整对比报告
- **优势**：数据完整，实验严谨

### 论文需要额外亮点

✅ **方案B + 方案C**
- 完整12拓扑对比（本地）
- 3拓扑硬件验证（飞腾派）
- ARM vs x86性能对比
- **优势**：实验全面，创新性强

---

## 论文呈现框架

### 5. 实验与评估

#### 5.1 实验环境

**5.1.1 本地仿真环境**
- 硬件：x86_64, WSL2
- 网络：Linux tc/netem仿真
- 拓扑：12种SAGIN NOMA拓扑

**5.1.2 硬件验证环境**（可选）
- 硬件：7×飞腾派（ARM）
- 网络：真实分布式部署
- 拓扑：3种代表性拓扑

#### 5.2 算法性能评估

**表1：握手协议性能对比（无网络延迟）**
- 数据：已有
- 结论：PQ快5倍

#### 5.3 网络环境性能评估

**5.3.1 理论分析**（方案A）
- 计算网络延迟影响
- 分析握手开销占比

**5.3.2 实测对比**（方案B）
- 12拓扑完整数据
- Classic vs PQ对比图表

**5.3.3 硬件验证**（方案C）
- 飞腾派实测数据
- ARM架构性能

#### 5.4 讨论

**网络延迟稀释效应**
- 理论模型
- 实测验证
- 适用场景分析

---

## 我的建议

考虑到论文撰写的时间压力，建议：

### 短期（本周）：方案A
- ✅ 数据充分
- ✅ 论点清晰
- ✅ 节省时间
- 专注论文撰写

### 长期（如有reviewer要求）：方案B
- 补充完整实验数据
- 回应审稿意见
- 提升论文质量

### 可选（额外加分）：方案C
- 硬件验证
- ARM性能
- 创新性

---

**下一步建议**：
1. 先按方案A完成论文初稿
2. 如果时间充足，补充方案B
3. 飞腾派验证可作为future work

你觉得哪个方案更合适？
