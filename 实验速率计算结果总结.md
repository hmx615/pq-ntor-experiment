# SAGIN 网络速率计算结果总结

**计算时间**: 2025-11-27
**数据来源**: 师妹提供的速率计算模型
**场景数量**: 15 个

---

## 一、关键发现

### 1.1 链路速率范围

| 链路类型 | 速率范围 | SINR 范围 | 典型场景 |
|---------|---------|----------|---------|
| 卫星链路 | 11.72 - 161.23 Mbps | -3.0 - 24.3 dB | 卫星→地面/UAV |
| 无人机链路 | 3.47 - 29.86 Mbps | 3.7 - 44.9 dB | UAV→地面用户 |
| D2D 链路 | 3.47 - 32.98 Mbps | 3.7 - 49.6 dB | 用户间直连 |
| 两跳链路 | 23.99 Mbps | 24.3 dB | 卫星→UAV→用户 |

**关键结论**:
- 卫星→UAV 链路速率最高 (161.23 Mbps)，因为 UAV 有高增益天线 (25 dB)
- 地面用户链路受限于天线增益 (5 dB)，速率显著降低
- 两跳链路的瓶颈在第二跳 (UAV→用户)，而非第一跳 (卫星→UAV)

---

### 1.2 OMA vs NOMA 性能对比

#### 卫星链路

| 用户位置 | OMA 速率 | NOMA 速率 | 速率损失 | NOMA 优势 |
|---------|---------|----------|---------|----------|
| 中心用户 (5km) | 35.06 Mbps | 15.50 Mbps | -55.8% | ❌ 显著下降 |
| 边缘用户 (15km) | 18.70 Mbps | 11.72 Mbps | -37.3% | ✅ 可接受 |

**解释**:
- NOMA 通过功率分配 (α=0.7) 牺牲强用户速率来保护弱用户
- 中心用户在 NOMA 下只能用 30% 功率，速率大幅下降
- 边缘用户获得 70% 功率，速率损失较小

#### 无人机链路

| 用户位置 | OMA 速率 | NOMA 速率 | 速率损失 | NOMA 优势 |
|---------|---------|----------|---------|----------|
| 近端用户 (0m) | 29.86 Mbps | 26.38 Mbps | -11.7% | ✅ 轻微损失 |
| 远端用户 (2.6km) | 23.99 Mbps | 3.47 Mbps | -85.5% | ❌ 严重下降 |

**解释**:
- 远端用户距离太远 (2.6km)，信道质量差异巨大
- NOMA 的 SIC (串行干扰消除) 在如此大的信道差异下效果差
- 远端用户虽然获得 70% 功率，但仍受到 30% 功率的强干扰

#### D2D 链路

| 用户位置 | OMA 速率 | NOMA 速率 | 速率损失 | NOMA 优势 |
|---------|---------|----------|---------|----------|
| 强用户 (30m) | 32.98 Mbps | 29.51 Mbps | -10.5% | ✅ 轻微损失 |
| 弱用户 (100m) | 22.56 Mbps | 3.47 Mbps | -84.6% | ❌ 严重下降 |

**解释**:
- 与 UAV 链路类似，距离差异导致 NOMA 效果不佳
- 弱用户虽然获得 70% 功率，但干扰严重

---

### 1.3 NOMA 适用性分析

**NOMA 表现良好的场景** (速率损失 < 15%):
1. 卫星→边缘用户: 37.3% 损失，但绝对速率仍可用 (11.72 Mbps)
2. UAV→近端用户: 11.7% 损失，绝对速率高 (26.38 Mbps)
3. D2D→强用户: 10.5% 损失，绝对速率高 (29.51 Mbps)

**NOMA 表现不佳的场景** (速率损失 > 80%):
1. UAV→远端用户: 85.5% 损失，速率降至 3.47 Mbps
2. D2D→弱用户: 84.6% 损失，速率降至 3.47 Mbps

**根本原因**:
- NOMA 要求**两用户信道差异适中**，信道增益比约 2-5 倍最佳
- 当信道增益比过大 (>10 倍) 时，弱用户受强干扰过大
- 功率分配 α=0.7 不足以补偿巨大的信道差异

---

## 二、对 PQ-NTOR 实验的影响

### 2.1 握手延迟预测

基于计算的速率和 PQ-NTOR 消息大小 (约 1.5 KB)，预测握手延迟:

| 场景 | 速率 | 传输延迟 | 传播延迟 | 总延迟 | 适合实验 |
|-----|------|---------|---------|--------|---------|
| 卫星→中心 OMA | 35.06 Mbps | 0.34 ms | 2.7 ms | 3.04 ms | ✅ 优秀 |
| 卫星→边缘 NOMA | 11.72 Mbps | 1.02 ms | 2.7 ms | 3.72 ms | ✅ 良好 |
| UAV→近端 OMA | 29.86 Mbps | 0.40 ms | 0.003 ms | 0.40 ms | ✅ 优秀 |
| UAV→远端 NOMA | 3.47 Mbps | 3.46 ms | 0.009 ms | 3.47 ms | ⚠️ 可接受 |
| D2D→强用户 OMA | 32.98 Mbps | 0.36 ms | 0.0003 ms | 0.36 ms | ✅ 优秀 |
| 两跳端到端 | 23.99 Mbps | 0.50 ms | 2.7 ms | 3.20 ms | ✅ 良好 |

**计算公式**:
```
传输延迟 = 消息大小 / 速率 = 1.5 KB / 速率
传播延迟 = 距离 / 光速
```

**结论**:
- 所有场景的握手延迟 < 5 ms，PQ-NTOR 可行
- 卫星链路的主要延迟来自传播延迟 (2.7 ms)，而非传输延迟
- 两跳链路的瓶颈在第二跳，但总延迟仍可接受

---

### 2.2 实验设计建议

#### 建议 1: 优先测试高速率场景

**推荐场景**:
1. 卫星→UAV (161.23 Mbps) - 展示最佳性能
2. 卫星→中心用户 OMA (35.06 Mbps) - 稳定高速
3. UAV→近端用户 OMA (29.86 Mbps) - 低延迟

**原因**: 这些场景的速率高、SINR 好，可以展示 PQ-NTOR 的最佳性能

#### 建议 2: 谨慎使用 NOMA 弱用户场景

**警告场景**:
1. UAV→远端用户 NOMA (3.47 Mbps)
2. D2D→弱用户 NOMA (3.47 Mbps)

**原因**: 这些场景速率过低，可能导致:
- 握手延迟 > 3 ms
- 超时风险增加
- 不能很好地展示 PQ-NTOR 优势

**替代方案**: 如果必须测试 NOMA 弱用户，应:
- 缩小两用户距离差异 (如中心 5km vs 边缘 10km，而非 0m vs 2.6km)
- 调整功率分配 α=0.8 (给弱用户更多功率)
- 增加带宽 (如从 2 MHz 增至 5 MHz)

#### 建议 3: 两跳实验的关键配置

**两跳场景** (卫星→UAV→用户):
- 第一跳速率: 161.23 Mbps (充足)
- 第二跳速率: 23.99 Mbps (瓶颈)
- 端到端速率: 23.99 Mbps

**实验配置**:
```bash
# 第一跳: 卫星→UAV (不需要限速，已经很快)
# 第二跳: UAV→用户 (需要应用 TC 限制)
tc qdisc add dev eth0 root tbf rate 24mbit burst 32kbit latency 400ms
tc qdisc add dev eth0 parent 1:1 netem delay 2.7ms loss 0.1%
```

**测试重点**:
- 验证端到端握手是否受第二跳限制
- 测量两跳累加的延迟
- 对比单跳 vs 两跳的性能差异

---

## 三、Linux TC 参数配置指南

### 3.1 延迟计算

| 链路类型 | 典型距离 | 传播延迟 | TC 配置 |
|---------|---------|---------|---------|
| 卫星 (GEO) | ~815 km | 2.72 ms | `delay 2.7ms` |
| 卫星 (LEO) | ~550 km | 1.83 ms | `delay 1.8ms` |
| 无人机 (1km高) | ~2.6 km | 0.009 ms | `delay 0.01ms` (可忽略) |
| D2D | ~100 m | 0.0003 ms | `delay 0ms` (可忽略) |

**注意**: 实际应用中，还需加上处理延迟 (约 1-5 ms)

### 3.2 丢包率估算

基于 SINR 的简化丢包率模型:

| SINR 范围 | 典型值 | 丢包率 | TC 配置 |
|---------|-------|-------|---------|
| > 20 dB | 优秀 | 0% | `loss 0%` |
| 10-20 dB | 良好 | 0.1% | `loss 0.1%` |
| 0-10 dB | 中等 | 1% | `loss 1%` |
| < 0 dB | 较差 | 5% | `loss 5%` |

**示例场景配置**:

```bash
# 场景 1: 卫星→中心用户 OMA (35.06 Mbps, SINR=3.75 dB)
tc qdisc add dev eth0 root tbf rate 35mbit burst 32kbit latency 400ms
tc qdisc add dev eth0 parent 1:1 netem delay 2.7ms loss 1%

# 场景 2: 卫星→边缘用户 NOMA (11.72 Mbps, SINR=-3.0 dB)
tc qdisc add dev eth0 root tbf rate 12mbit burst 32kbit latency 400ms
tc qdisc add dev eth0 parent 1:1 netem delay 2.7ms loss 5%

# 场景 3: UAV→近端用户 OMA (29.86 Mbps, SINR=44.9 dB)
tc qdisc add dev eth0 root tbf rate 30mbit burst 32kbit latency 400ms
tc qdisc add dev eth0 parent 1:1 netem delay 0.01ms loss 0%

# 场景 4: D2D→强用户 OMA (32.98 Mbps, SINR=49.6 dB)
tc qdisc add dev eth0 root tbf rate 33mbit burst 32kbit latency 400ms
tc qdisc add dev eth0 parent 1:1 netem delay 0ms loss 0%
```

---

## 四、12 拓扑映射

基于计算结果，为 12 个拓扑分配速率参数:

| 拓扑 ID | 名称 | 链路类型 | 多址方式 | 速率 (Mbps) | SINR (dB) | 推荐测试 |
|--------|------|---------|---------|------------|----------|---------|
| 1 | Z1-UP1-OMA | 卫星→中心用户 | OMA | 35.06 | 3.75 | ⭐⭐⭐ |
| 2 | Z1-UP1-NOMA-S | 卫星→中心用户 | NOMA | 15.50 | -1.48 | ⭐⭐ |
| 3 | Z1-UP1-NOMA-W | 卫星→边缘用户 | NOMA | 11.72 | -3.00 | ⭐⭐ |
| 4 | Z1-UP2-OMA | 无人机→近端 | OMA | 29.86 | 44.94 | ⭐⭐⭐ |
| 5 | Z1-UP2-NOMA-S | 无人机→近端 | NOMA | 26.38 | 39.71 | ⭐⭐⭐ |
| 6 | Z1-UP2-NOMA-W | 无人机→远端 | NOMA | 3.47 | 3.68 | ⚠️ |
| 7 | Z2-D2D-OMA | D2D 强用户 | OMA | 32.98 | 49.64 | ⭐⭐⭐ |
| 8 | Z2-D2D-NOMA-S | D2D 强用户 | NOMA | 29.51 | 44.41 | ⭐⭐⭐ |
| 9 | Z2-D2D-NOMA-W | D2D 弱用户 | NOMA | 3.47 | 3.67 | ⚠️ |
| 10 | Z3-2Hop-Sat | 卫星→UAV | OMA | 161.23 | 24.25 | ⭐⭐⭐ |
| 11 | Z3-2Hop-UAV | UAV→用户 | OMA | 23.99 | 36.11 | ⭐⭐⭐ |
| 12 | Z3-2Hop-Full | 两跳端到端 | OMA | 23.99 | 24.25 | ⭐⭐⭐ |

**推荐优先级**:
- ⭐⭐⭐: 优先测试，速率高、稳定性好
- ⭐⭐: 可选测试，速率中等
- ⚠️: 谨慎测试，速率低、可能超时

---

## 五、实验预期成果

### 5.1 OMA vs NOMA 对比

**假设**: 在相同 SINR 下，PQ-NTOR 握手延迟主要受速率影响

**预期结果**:

| 链路类型 | OMA 延迟 | NOMA 延迟 | 延迟增加 | 结论 |
|---------|---------|----------|---------|------|
| 卫星→中心 | 3.04 ms | 3.44 ms | +13% | NOMA 轻微增加 |
| 卫星→边缘 | 3.43 ms | 3.72 ms | +8% | NOMA 影响小 |
| UAV→近端 | 0.40 ms | 0.46 ms | +15% | NOMA 轻微增加 |
| UAV→远端 | 0.50 ms | 3.47 ms | +594% | NOMA 严重影响 |
| D2D→强用户 | 0.36 ms | 0.41 ms | +14% | NOMA 轻微增加 |

**论文结论支撑**:
- [x] NOMA 在信道质量相近时对 PQ-NTOR 影响小 (< 15%)
- [x] NOMA 在信道质量差异大时显著增加延迟 (> 500%)
- [x] 建议 SAGIN 网络在**信道条件良好**时优先使用 NOMA

### 5.2 两跳性能分析

**预期结果**:
- 第一跳 (卫星→UAV) 延迟: 0.34 ms
- 第二跳 (UAV→用户) 延迟: 0.50 ms
- 端到端延迟: 0.84 ms + 2.7 ms (传播) = 3.54 ms

**对比单跳卫星→用户直连**:
- 直连延迟: 3.04 ms (卫星→中心用户 OMA)
- 两跳延迟: 3.54 ms
- 延迟增加: +16%

**论文结论支撑**:
- [x] 两跳中继虽然增加处理开销，但延迟仍可接受
- [x] UAV 高增益天线显著提升第一跳速率，部分抵消两跳开销
- [x] 端到端性能主要受第二跳限制

---

## 六、下一步工作

### 6.1 立即行动

1. **生成配置文件**:
   ```bash
   python3 scripts/generate_topo_configs.py
   ```
   为 12 个拓扑生成完整的 JSON 配置文件

2. **创建 TC 应用脚本**:
   ```bash
   python3 scripts/apply_tc_config.py --topology 1
   ```
   自动应用计算的网络参数

3. **在飞腾派上测试**:
   ```bash
   ./sagin-experiments/scripts/run_12topo_with_params.sh
   ```

### 6.2 可选优化

1. **调整 NOMA 功率分配**:
   - 当前 α=0.7 可能不是最优
   - 建议测试 α=0.75, 0.8, 0.85

2. **缩小用户距离差异**:
   - UAV 远端用户从 2.6km 缩小至 1.5km
   - D2D 弱用户从 100m 缩小至 60m

3. **增加带宽**:
   - UAV 和 D2D 从 2 MHz 增至 5 MHz
   - 可以显著提升弱用户速率

---

## 七、关键数据汇总

### 速率排名 (Top 5)

1. 卫星→UAV: **161.23 Mbps** (SINR=24.25 dB)
2. 卫星→中心用户 OMA: **35.06 Mbps** (SINR=3.75 dB)
3. D2D 强用户 OMA: **32.98 Mbps** (SINR=49.64 dB)
4. UAV→近端用户 OMA: **29.86 Mbps** (SINR=44.94 dB)
5. D2D 强用户 NOMA: **29.51 Mbps** (SINR=44.41 dB)

### 速率排名 (Bottom 3)

1. UAV→远端用户 NOMA: **3.47 Mbps** (SINR=3.68 dB)
2. D2D 弱用户 NOMA: **3.47 Mbps** (SINR=3.67 dB)
3. 卫星→边缘用户 NOMA: **11.72 Mbps** (SINR=-3.0 dB)

### NOMA 性能损失汇总

| 场景 | OMA | NOMA | 损失率 | 评价 |
|-----|-----|------|-------|------|
| 卫星→中心 | 35.06 | 15.50 | 55.8% | 不推荐 |
| 卫星→边缘 | 18.70 | 11.72 | 37.3% | 可接受 |
| UAV→近端 | 29.86 | 26.38 | 11.7% | 推荐 |
| UAV→远端 | 23.99 | 3.47 | 85.5% | 不推荐 |
| D2D→强用户 | 32.98 | 29.51 | 10.5% | 推荐 |
| D2D→弱用户 | 22.56 | 3.47 | 84.6% | 不推荐 |

---

**文档生成时间**: 2025-11-27
**数据来源**: `results/all_scenarios_rates.json`
**计算程序**: `scripts/unified_rate_calc.py`
